# 公考督学助手 - AI高效协作开发规范

## 🎯 核心目标
**快速迭代，高质量交付，零Bug上线**

## 📋 开发工作流

### Phase 1: 任务接收
```
输入格式：
【功能】：具体功能描述
【优先级】：P0/P1/P2
【验收标准】：明确的完成定义
【依赖】：前置条件或依赖模块

输出确认：
- ✅ 需求理解确认
- ✅ 技术方案概述  
- ✅ 预估时间
- ❓ 澄清问题（如有）
```

### Phase 2: 设计实现 
```
执行顺序：
1. 数据模型设计
2. 接口设计
3. 核心逻辑实现
4. 错误处理
5. 基础测试

质量检查：
- 代码规范自检
- 边界情况处理
- 用户体验考量
- 性能基本优化
```

### Phase 3: 交付验证
```
交付物：
- ✅ 可运行代码
- ✅ 关键功能演示
- ✅ 潜在问题说明
- ✅ 后续优化建议

验证清单：
- 核心功能正常
- 异常情况优雅处理
- 代码可读性良好
- 符合PRD要求
```

## 🏗️ 架构设计原则

### 模块化设计
```
后端模块：
├── models/          # 数据模型（单一职责）
├── api/            # 接口层（薄薄一层）
├── services/       # 业务逻辑（核心实现）
├── utils/          # 工具函数（纯函数）
└── tests/          # 测试用例（覆盖主路径）

前端模块：
├── pages/          # 页面组件（视图层）
├── components/     # 通用组件（可复用）
├── modules/        # 业务模块（逻辑封装）
├── utils/          # 工具函数（纯函数）
└── assets/         # 静态资源
```

### 接口约定
```javascript
// 统一响应格式
{
  "code": 0,        // 0=成功，其他=错误码
  "msg": "ok",      // 人类可读消息
  "data": {}        // 实际数据
}

// 统一错误处理
try {
  // 业务逻辑
} catch (error) {
  return ErrorResponse(error.code, error.message)
}
```

## 🔧 代码质量标准

### 必须遵守的规范
1. **单一职责**：每个函数只做一件事
2. **清晰命名**：见名知意，避免缩写
3. **错误处理**：所有异常都有优雅降级
4. **注释完备**：复杂逻辑必须有注释
5. **类型安全**：关键参数做类型检查

### 代码示例模板
```javascript
/**
 * 提交作业
 * @param {string} taskId - 任务ID
 * @param {Array} images - 图片数组
 * @param {string} description - 作业描述
 * @returns {Promise<Object>} 提交结果
 */
async function submitAssignment(taskId, images, description) {
  // 1. 参数验证
  if (!taskId || !images?.length) {
    throw new ValidationError('参数不完整')
  }
  
  // 2. 业务逻辑
  const submission = await submissionService.create({
    task_id: taskId,
    images: images,
    description: description
  })
  
  // 3. 返回结果
  return {
    code: 0,
    msg: '提交成功',
    data: submission
  }
}
```

## 🚀 快速开发模式

### AI开发时的思维框架
1. **理解需求** → 明确输入输出，确定边界
2. **设计接口** → 定义数据结构，约定调用方式
3. **实现核心** → 最小可用版本，专注主流程
4. **处理异常** → 预测失败情况，优雅降级
5. **验证功能** → 构造测试用例，确保正确性

### 快速决策原则
- **优先可用性** > 完美优化
- **用户体验** > 技术炫技
- **简单直接** > 过度设计
- **文档清晰** > 代码巧妙

## 📚 文档驱动开发

### 核心产品文档
- **PRD_main.md**: 功能需求主文档，定义业务逻辑和用户角色
- **UI_design_specs.md**: UI设计规范，15个页面交互定义  
- **user_story_map.md**: 用户故事地图，8个主要业务流程

### 实时文档更新
- **新功能** → 同步更新API文档
- **Bug修复** → 记录到issues/文档
- **架构变更** → 更新decisions/文档
- **部署变更** → 更新deployment/文档


## 📚 分布式文档管理SOP

### 核心文档约束阅读原则
**开发前必读**：
1. **组件级约束**: 开发任何组件前，优先阅读对应文件夹的README.md
2. **模块级约束**: 涉及业务逻辑时，查阅对应业务模块的约束文档
3. **核心文档**: 复杂功能开发需要回顾PRD_main.md相关章节

### 约束文档分发体系
```
项目根目录核心文档：
├── docs/product/PRD_main.md           # 主要产品需求文档
├── docs/product/UI_design_specs.md    # UI设计规范
├── docs/product/user_story_map.md     # 用户故事地图

组件级约束文档分发：
├── backend/app/api/README.md          # API业务逻辑约束
├── backend/app/services/README.md     # 服务层数据处理约束
├── backend/app/models/README.md       # 数据模型语义约束
├── miniprogram/components/README.md   # UI组件交互约束
├── miniprogram/pages/README.md        # 页面流程约束
├── miniprogram/modules/README.md      # 业务模块约束
```

### 长期上下文管理策略
**重要信息分散存储原则**：
1. **避免丢失**: 核心约束信息写入组件README.md，避免AI上下文限制导致的信息丢失
2. **就近原则**: 开发相关约束紧贴代码存储，提高查阅效率
3. **同步更新**: 核心文档更新时，同步更新相关组件约束文档

### 微信小程序开发特别约束
**官方组件和API优先原则**：
1. **必须优先查阅微信小程序官方文档**：开发任何与微信生态相关的功能前
2. **复用官方组件**：分享、支付、定位、录音等功能优先使用官方API
3. **遵循官方设计规范**：UI设计和交互遵循微信小程序设计指南
4. **官方更新跟进**：定期检查官方文档更新，及时适配新特性

### AI开发SOP核心规则
```
开发流程标准化：
1. 阅读组件README.md约束 (必须)
2. 查阅微信官方文档 (微信功能必须)
3. 遵循现有架构模式 (必须)
4. 完整错误处理机制 (必须)
5. 及时更新约束文档 (推荐)
```

## 🎯 成功标准

### 质量目标
- **功能正确性**：100%符合需求
- **代码可读性**：人类和AI都易懂
- **错误处理**：边界情况全覆盖
- **用户体验**：操作流畅，提示友好

## 📋 产品功能开发标准SOP

### 产品经理功能开发流程

#### 阶段1: 需求挖掘与创新探索
- **输入**：产品经理提供探索方向的关键词（如"认知科学"、"学习记忆"、"个性化教育"等）
- **执行**：基于关键词进行深度调研，从科学理论、行业趋势、用户痛点等维度思考
- **产出**：12-20个创新思路清单，标注价值评估和可行性分析
- **筛选**：与产品经理讨论选定3-5个核心功能进行深化

#### 阶段2: 功能方案设计
- **设计原则**：低成本、可落地、易融入现有系统
- **方案优化**：将复杂创意简化为MVP可实现版本
- **迭代细化**：基于产品经理反馈持续调整功能细节和边界
- **确认方案**：最终确定功能的核心价值和实现路径

#### 阶段3: PRD规范化撰写  
- **PRD编写**：撰写详细的功能需求文档，包含业务逻辑、交互流程、验收标准
- **用户故事**：编写完整的用户故事，明确使用场景和价值点
- **多轮review**：与产品经理讨论优化，确保需求准确无歧义
- **最终确认**：功能方案和文档内容经产品经理确认无误

#### 阶段4: 核心文档同步更新
- **文档更新范围**：
  - PRD_main.md：更新功能需求描述
  - user_story_map.md：新增用户故事和验收标准  
  - UI_design_specs.md：更新界面设计规范
- **一致性检查**：确保三个文档间信息同步，无矛盾
- **完整性验证**：为后续开发提供完整准确的指导文档

#### 关键原则
- **理论驱动 + 用户导向**：基于科学理论挖掘创新点，以用户需求验证价值
- **简化实用的MVP理念**：将复杂想法转化为可实现的最小可行产品
- **严格的文档标准化**：确保需求文档完整、准确、一致
- **持续迭代优化**：基于反馈不断完善功能设计

#### 成功标准
- 功能需求清晰准确，开发团队可直接执行
- 核心文档保持同步一致，信息无冲突
- 整体流程高效可复制，形成标准化工作模式

## 🛠️ 项目特定配置

### 技术栈
- **后端**：FastAPI + SQLAlchemy + SQLite(开发)/PostgreSQL(生产)
- **前端**：微信小程序原生框架 + 模块化设计
- **存储**：本地文件(开发) → 阿里云OSS(生产)
- **认证**：JWT + 微信授权


### 功能开发优先级

#### V1.0 技术预留功能  
1. **成就徽章系统** - 保留设计预留，暂不具体实现
   - **数据库设计**: 预留 `user_achievements` 表和相关字段
   - **后端预留**: 创建徽章相关的数据模型和基础接口
   - **前端预留**: 个人中心预留徽章展示区域
   - **目的**: 为后续版本的徽章功能做好技术基础，避免重构
   - **实现时机**: V1.5 或 V2.0 版本正式开发

**技术预留原则**：
- 数据表结构提前设计，但不实现业务逻辑
- 接口和组件预留位置，但返回空数据或隐藏显示
- 确保核心功能稳定后再开发激励系统


**核心理念**：快速、正确、优雅，让开发者专注产品而非代码细节

---

> 最后更新：2025-09-06
> 版本：v1.0
> 维护者：AI Assistant + 产品团队