<!-- æ²‰æµ¸å¼æ‰¹æ”¹å¯¼èˆªç»„ä»¶ -->
<view class="grading-navigator-container" bindtouchstart="onTouchStart" bindtouchend="onTouchEnd">
  
  <!-- é¡¶éƒ¨è¿›åº¦æŒ‡ç¤ºå™¨ -->
  <view class="progress-header">
    <view class="progress-track">
      <view class="progress-fill" style="width: {{progressPercent}}%"></view>
      <view class="progress-indicator" style="left: {{progressPercent}}%">
        <view class="indicator-dot"></view>
        <view class="indicator-label">{{currentIndex + 1}}/{{totalCount}}</view>
      </view>
    </view>
    
    <!-- æ‰¹æ”¹ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="grading-stats">
      <view class="stat-item completed">
        <text class="stat-icon">âœ…</text>
        <text class="stat-number">{{completedCount}}</text>
        <text class="stat-label">å·²æ‰¹æ”¹</text>
      </view>
      <view class="stat-item pending">
        <text class="stat-icon">â³</text>
        <text class="stat-number">{{pendingCount}}</text>
        <text class="stat-label">å¾…æ‰¹æ”¹</text>
      </view>
      <view class="stat-item efficiency" wx:if="{{showEfficiency}}">
        <text class="stat-icon">âš¡</text>
        <text class="stat-number">{{avgGradingTime}}</text>
        <text class="stat-label">å¹³å‡ç”¨æ—¶</text>
      </view>
    </view>
  </view>

  <!-- å­¦ç”Ÿä¿¡æ¯å¡ç‰‡ï¼ˆå¢å¼ºç‰ˆï¼‰ -->
  <view class="student-info-card">
    <view class="student-main">
      <image 
        class="student-avatar" 
        src="{{currentStudent.avatar}}" 
        mode="aspectFill" 
        wx:if="{{currentStudent.avatar}}" 
        lazy-load="true"
        binderror="onImageError"
      />
      <view class="avatar-placeholder" wx:else>
        <text>ğŸ‘¤</text>
      </view>
      
      <view class="student-details">
        <view class="student-name">{{currentStudent.nickname || 'å­¦ç”Ÿ'}}</view>
        <view class="submission-meta">
          <text class="attempt-info">ç¬¬{{currentStudent.attemptNumber}}æ¬¡æäº¤</text>
          <text class="time-info">{{currentStudent.timeAgo}}</text>
          <view class="submission-status {{currentStudent.status}}">
            {{currentStudent.statusText}}
          </view>
        </view>
      </view>
    </view>
    
    <!-- å¿«æ·æ“ä½œå·¥å…·æ  -->
    <view class="quick-actions">
      <button class="action-icon-btn" bindtap="showHistory" data-action="history">
        <text class="action-icon">ğŸ“‹</text>
      </button>
      <button class="action-icon-btn" bindtap="markFlag" data-action="flag">
        <text class="action-icon {{currentStudent.flagged ? 'flagged' : ''}}">ğŸš©</text>
      </button>
      <button class="action-icon-btn" bindtap="addNote" data-action="note">
        <text class="action-icon">ğŸ“</text>
      </button>
    </view>
  </view>

  <!-- å¯¼èˆªæ§åˆ¶åŒº -->
  <view class="navigation-controls">
    
    <!-- å·¦ä¾§å¯¼èˆª -->
    <view class="nav-section left">
      <button 
        class="nav-btn primary {{currentIndex === 0 ? 'disabled' : ''}}" 
        disabled="{{currentIndex === 0}}"
        bindtap="previousSubmission"
        bindlongpress="jumpToFirst"
      >
        <text class="btn-icon">â†</text>
        <text class="btn-text">ä¸Šä¸€ä»½</text>
      </button>
    </view>

    <!-- ä¸­é—´å¿«æ·è·³è½¬ -->
    <view class="nav-section center">
      <view class="quick-jump">
        <button class="jump-btn" bindtap="showSubmissionList">
          <text class="current-position">{{currentIndex + 1}}</text>
          <text class="total-count">/{{totalCount}}</text>
          <text class="jump-icon">ğŸ“‹</text>
        </button>
      </view>
      
      <!-- æ‰‹åŠ¿æç¤º -->
      <view class="gesture-hint" wx:if="{{showGestureHint}}">
        <text class="hint-text">å·¦å³æ»‘åŠ¨å¿«é€Ÿåˆ‡æ¢</text>
      </view>
    </view>

    <!-- å³ä¾§å¯¼èˆª -->
    <view class="nav-section right">
      <button 
        class="nav-btn primary {{currentIndex === totalCount - 1 ? 'disabled' : ''}}" 
        disabled="{{currentIndex === totalCount - 1}}"
        bindtap="nextSubmission"
        bindlongpress="jumpToLast"
      >
        <text class="btn-text">ä¸‹ä¸€ä»½</text>
        <text class="btn-icon">â†’</text>
      </button>
    </view>
  </view>

  <!-- æ™ºèƒ½æ¨èå¯¼èˆª -->
  <view class="smart-navigation" wx:if="{{showSmartNav}}">
    <view class="smart-nav-header">
      <text class="smart-title">æ™ºèƒ½æ¨è</text>
      <text class="smart-subtitle">åŸºäºæ‰¹æ”¹ä¹ æƒ¯ä¸ºæ‚¨æ¨è</text>
    </view>
    
    <scroll-view class="smart-options" scroll-x>
      <view class="smart-option-list">
        <button 
          wx:for="{{smartRecommendations}}" 
          wx:key="id"
          class="smart-option {{item.type}}"
          bindtap="jumpToSubmission"
          data-index="{{item.index}}"
        >
          <view class="option-icon">{{item.icon}}</view>
          <view class="option-content">
            <text class="option-title">{{item.title}}</text>
            <text class="option-desc">{{item.description}}</text>
          </view>
        </button>
      </view>
    </scroll-view>
  </view>

  <!-- æ‰¹æ”¹è¿›åº¦æé†’ -->
  <view class="progress-reminder" wx:if="{{showProgressReminder}}">
    <view class="reminder-content">
      <text class="reminder-icon">ğŸ¯</text>
      <text class="reminder-text">{{progressReminderText}}</text>
    </view>
    <button class="reminder-action" bindtap="handleProgressAction">
      {{progressActionText}}
    </button>
  </view>

  <!-- å¿«æ·é”®æç¤º -->
  <view class="keyboard-shortcuts" wx:if="{{showShortcuts}}">
    <view class="shortcuts-header">å¿«æ·é”®</view>
    <view class="shortcuts-list">
      <view class="shortcut-item">
        <text class="shortcut-key">â† â†’</text>
        <text class="shortcut-desc">åˆ‡æ¢ä½œä¸š</text>
      </view>
      <view class="shortcut-item">
        <text class="shortcut-key">Space</text>
        <text class="shortcut-desc">å®Œæˆæ‰¹æ”¹</text>
      </view>
      <view class="shortcut-item">
        <text class="shortcut-key">H</text>
        <text class="shortcut-desc">æŸ¥çœ‹å†å²</text>
      </view>
    </view>
  </view>

</view>

<!-- ä½œä¸šåˆ—è¡¨å¼¹çª— -->
<view class="submission-list-modal" wx:if="{{showSubmissionModal}}" bindtap="hideSubmissionList">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©ä½œä¸š</text>
      <button class="close-btn" bindtap="hideSubmissionList">âœ•</button>
    </view>
    
    <scroll-view class="submission-items" scroll-y max-height="60vh">
      <button 
        wx:for="{{submissionList}}" 
        wx:key="id"
        class="submission-item {{index === currentIndex ? 'current' : ''}} {{item.status}}"
        bindtap="selectSubmission"
        data-index="{{index}}"
      >
        <view class="item-info">
          <image class="item-avatar" src="{{item.user.avatar}}" mode="aspectFill" wx:if="{{item.user.avatar}}" />
          <view class="item-avatar placeholder" wx:else>ğŸ‘¤</view>
          <view class="item-details">
            <text class="item-name">{{item.user.nickname || 'å­¦ç”Ÿ'}}</text>
            <text class="item-time">{{item.timeAgo}}</text>
          </view>
        </view>
        
        <view class="item-status">
          <view class="status-badge {{item.status}}">{{item.statusText}}</view>
          <text class="item-index">{{index + 1}}</text>
        </view>
      </button>
    </scroll-view>
  </view>
</view>