<!-- components/enhanced-uploader/enhanced-uploader.wxml -->
<view class="enhanced-uploader {{disabled ? 'disabled' : ''}}">
  
  <!-- ä¸Šä¼ æŒ‰é’®åŒºåŸŸ -->
  <view class="upload-area" wx:if="{{fileList.length < maxCount}}">
    <view class="upload-button" bindtap="chooseImages">
      <view class="upload-icon">ğŸ“·</view>
      <text class="upload-text">{{buttonText}}</text>
      <text class="upload-count">{{fileList.length}}/{{maxCount}}</text>
    </view>
    
    <!-- ä¸Šä¼ æç¤º -->
    <view class="upload-tips" wx:if="{{showTips}}">
      <text class="tip-text">æ”¯æŒ{{acceptTypesText}}æ ¼å¼ï¼Œå•å¼ å›¾ç‰‡ä¸è¶…è¿‡{{maxSize}}MB</text>
      <text class="tip-compression" wx:if="{{enableCompress}}">âœ¨ è‡ªåŠ¨å‹ç¼©ä¼˜åŒ–</text>
    </view>
  </view>

  <!-- æ–‡ä»¶åˆ—è¡¨ -->
  <view class="file-list" wx:if="{{fileList.length > 0}}">
    <view class="list-header">
      <view class="list-info">
        <text class="file-count">{{fileList.length}}å¼ å›¾ç‰‡</text>
        <text class="size-info" wx:if="{{compressionRatio > 0}}">
          å·²å‹ç¼©{{compressionRatio}}%ï¼ŒèŠ‚çœ{{formatFileSize(totalSize - compressedSize)}}
        </text>
      </view>
      
      <view class="list-actions">
        <button class="clear-btn" bindtap="clearAll" size="mini">
          ğŸ—‘ï¸ æ¸…ç©º
        </button>
      </view>
    </view>
    
    <!-- å›¾ç‰‡ç½‘æ ¼ -->
    <view class="image-grid" style="grid-template-columns: repeat({{columns}}, 1fr);">
      <view 
        class="image-item {{item.status}}" 
        wx:for="{{fileList}}" 
        wx:key="id"
        data-index="{{index}}"
      >
        <!-- å›¾ç‰‡é¢„è§ˆ -->
        <view class="image-preview" bindtap="previewImage" data-index="{{index}}">
          <image 
            class="preview-image" 
            src="{{item.thumbnail}}" 
            mode="aspectFill"
            lazy-load="{{true}}"
          />
          
          <!-- çŠ¶æ€é®ç½© -->
          <view class="status-overlay" wx:if="{{item.status !== 'ready'}}">
            
            <!-- ä¸Šä¼ ä¸­ -->
            <view class="uploading-overlay" wx:if="{{item.status === 'uploading'}}">
              <view class="progress-circle">
                <view class="progress-text">{{item.progress}}%</view>
                <view class="progress-ring">
                  <svg class="progress-svg" width="40" height="40">
                    <circle 
                      class="progress-bg" 
                      cx="20" 
                      cy="20" 
                      r="18"
                      fill="none" 
                      stroke="#e6e6e6" 
                      stroke-width="2"
                    />
                    <circle 
                      class="progress-bar" 
                      cx="20" 
                      cy="20" 
                      r="18"
                      fill="none" 
                      stroke="#1989fa" 
                      stroke-width="2"
                      stroke-dasharray="{{113.1 * item.progress / 100}} 113.1"
                      stroke-dashoffset="0"
                      transform="rotate(-90 20 20)"
                    />
                  </svg>
                </view>
              </view>
            </view>
            
            <!-- ä¸Šä¼ æˆåŠŸ -->
            <view class="success-overlay" wx:if="{{item.status === 'success'}}">
              <view class="success-icon">âœ…</view>
            </view>
            
            <!-- ä¸Šä¼ å¤±è´¥ -->
            <view class="error-overlay" wx:if="{{item.status === 'failed'}}">
              <view class="error-icon">âŒ</view>
              <button class="retry-btn" bindtap="retryUpload" data-index="{{index}}">
                é‡è¯•
              </button>
            </view>
          </view>
        </view>
        
        <!-- æ–‡ä»¶ä¿¡æ¯ -->
        <view class="file-info">
          <text class="file-name">{{item.name}}</text>
          <view class="file-meta">
            <text class="file-size">{{formatFileSize(item.compressedSize)}}</text>
            <text class="file-dimensions" wx:if="{{item.width && item.height}}">
              {{item.width}}Ã—{{item.height}}
            </text>
            <text class="compression-info" wx:if="{{item.compressionRatio > 0}}">
              å‹ç¼©{{item.compressionRatio}}%
            </text>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="file-actions">
          <button 
            class="delete-btn" 
            bindtap="deleteFile" 
            data-index="{{index}}"
            size="mini"
          >
            åˆ é™¤
          </button>
        </view>
      </view>
    </view>
  </view>
  
  <!-- ä¸Šä¼ è¿›åº¦æ¡ï¼ˆå…¨å±€ï¼‰ -->
  <view class="upload-progress" wx:if="{{uploading}}">
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{uploadProgress}}%"></view>
    </view>
    <text class="progress-text">æ­£åœ¨å¤„ç†... {{uploadProgress}}%</text>
  </view>
  
  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="upload-stats" wx:if="{{fileList.length > 0 && !uploading}}">
    <view class="stats-item">
      <text class="stats-label">åŸå§‹å¤§å°ï¼š</text>
      <text class="stats-value">{{formatFileSize(totalSize)}}</text>
    </view>
    <view class="stats-item" wx:if="{{compressionRatio > 0}}">
      <text class="stats-label">å‹ç¼©åï¼š</text>
      <text class="stats-value">{{formatFileSize(compressedSize)}}</text>
    </view>
    <view class="stats-item" wx:if="{{compressionRatio > 0}}">
      <text class="stats-label">å‹ç¼©ç‡ï¼š</text>
      <text class="stats-value">{{compressionRatio}}%</text>
    </view>
  </view>
  
  <!-- é”™è¯¯æç¤º -->
  <view class="error-toast {{showError ? 'show' : ''}}" wx:if="{{errorMessage}}">
    <view class="error-content">
      <text class="error-icon">âš ï¸</text>
      <text class="error-text">{{errorMessage}}</text>
    </view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{fileList.length === 0 && !uploading}}">
    <view class="empty-icon">ğŸ“¸</view>
    <text class="empty-text">è¿˜æ²¡æœ‰ä¸Šä¼ ä»»ä½•å›¾ç‰‡</text>
    <button class="empty-action" bindtap="chooseImages">
      é€‰æ‹©å›¾ç‰‡
    </button>
  </view>
  
</view>