<!-- æ‰¹æ”¹æ•°æ®ç»Ÿè®¡é¢æ¿ -->
<view class="analytics-container" wx:if="{{show}}">
  
  <!-- é®ç½©å±‚ -->
  <view class="analytics-mask" bindtap="close"></view>
  
  <!-- é¢æ¿å†…å®¹ -->
  <view class="analytics-panel" catchtap="stopPropagation">
    
    <!-- å¤´éƒ¨ -->
    <view class="analytics-header">
      <view class="header-left">
        <text class="title">ğŸ“Š æ‰¹æ”¹æ•°æ®ç»Ÿè®¡</text>
        <text class="subtitle">{{taskTitle}}çš„æ‰¹æ”¹åˆ†ææŠ¥å‘Š</text>
      </view>
      <button class="close-btn" bindtap="close">âœ•</button>
    </view>
    
    <!-- æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
    <scroll-view class="analytics-content" scroll-y enhanced show-scrollbar="{{false}}">
      
      <!-- æ€»è§ˆå¡ç‰‡ -->
      <view class="overview-section">
        <view class="section-title">
          <text class="title-icon">ğŸ“‹</text>
          <text class="title-text">æ‰¹æ”¹æ€»è§ˆ</text>
        </view>
        
        <view class="overview-cards">
          <view class="overview-card total">
            <text class="card-number">{{analytics.totalSubmissions}}</text>
            <text class="card-label">æ€»æäº¤æ•°</text>
            <view class="card-trend up" wx:if="{{analytics.submissionTrend > 0}}">
              <text class="trend-icon">â†—</text>
              <text class="trend-text">+{{analytics.submissionTrend}}%</text>
            </view>
          </view>
          
          <view class="overview-card completed">
            <text class="card-number">{{analytics.completedCount}}</text>
            <text class="card-label">å·²æ‰¹æ”¹</text>
            <view class="card-progress">
              <view class="progress-bar">
                <view class="progress-fill" style="width: {{analytics.completionRate}}%"></view>
              </view>
              <text class="progress-text">{{analytics.completionRate}}%</text>
            </view>
          </view>
          
          <view class="overview-card efficiency">
            <text class="card-number">{{analytics.avgGradingTime}}</text>
            <text class="card-label">å¹³å‡ç”¨æ—¶</text>
            <view class="efficiency-level {{analytics.efficiencyLevel}}">
              <text class="level-text">{{analytics.efficiencyText}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- æ¡£ä½åˆ†å¸ƒå›¾è¡¨ -->
      <view class="grade-distribution-section">
        <view class="section-title">
          <text class="title-icon">ğŸ“ˆ</text>
          <text class="title-text">æˆç»©æ¡£ä½åˆ†å¸ƒ</text>
          <view class="title-actions">
            <view class="title-action" bindtap="exportGradeDistribution">
              <text class="action-text">å¯¼å‡ºæˆç»©</text>
            </view>
            <view class="title-action" bindtap="toggleGradeView">
              <text class="action-text">{{gradeViewMode === 'chart' ? 'åˆ—è¡¨è§†å›¾' : 'å›¾è¡¨è§†å›¾'}}</text>
            </view>
          </view>
        </view>
        
        <!-- å›¾è¡¨è§†å›¾ -->
        <view class="grade-chart" wx:if="{{gradeViewMode === 'chart'}}">
          <view class="chart-container">
            <view class="chart-bars">
              <view 
                wx:for="{{analytics.gradeDistribution}}" 
                wx:key="grade"
                class="chart-bar"
                style="height: {{item.percentage}}%"
              >
                <view class="bar-fill {{item.grade}}"></view>
                <text class="bar-label">{{item.label}}</text>
                <text class="bar-count">{{item.count}}</text>
              </view>
            </view>
          </view>
          
          <view class="chart-legend">
            <view 
              wx:for="{{analytics.gradeDistribution}}" 
              wx:key="grade"
              class="legend-item"
            >
              <view class="legend-color {{item.grade}}"></view>
              <text class="legend-text">{{item.label}} ({{item.count}})</text>
            </view>
          </view>
        </view>
        
        <!-- åˆ—è¡¨è§†å›¾ -->
        <view class="grade-list" wx:else>
          <view 
            wx:for="{{analytics.gradeDistribution}}" 
            wx:key="grade"
            class="grade-item {{item.grade}}"
          >
            <view class="grade-info">
              <text class="grade-icon">{{item.icon}}</text>
              <view class="grade-detail">
                <text class="grade-name">{{item.label}}</text>
                <text class="grade-desc">{{item.description}}</text>
              </view>
            </view>
            
            <view class="grade-stats">
              <text class="grade-count">{{item.count}}äºº</text>
              <view class="grade-progress">
                <view class="progress-track">
                  <view class="progress-fill {{item.grade}}" style="width: {{item.percentage}}%"></view>
                </view>
                <text class="progress-percent">{{item.percentage}}%</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- æ•ˆç‡åˆ†æ -->
      <view class="efficiency-section">
        <view class="section-title">
          <text class="title-icon">âš¡</text>
          <text class="title-text">æ‰¹æ”¹æ•ˆç‡åˆ†æ</text>
        </view>
        
        <view class="efficiency-metrics">
          <view class="metric-card">
            <text class="metric-label">ä»Šæ—¥æ‰¹æ”¹</text>
            <text class="metric-value">{{analytics.todayGraded}}</text>
            <text class="metric-unit">ä»½</text>
          </view>
          
          <view class="metric-card">
            <text class="metric-label">æœ¬å‘¨æ‰¹æ”¹</text>
            <text class="metric-value">{{analytics.weekGraded}}</text>
            <text class="metric-unit">ä»½</text>
          </view>
          
          <view class="metric-card">
            <text class="metric-label">å³°å€¼é€Ÿåº¦</text>
            <text class="metric-value">{{analytics.peakSpeed}}</text>
            <text class="metric-unit">åˆ†/ä»½</text>
          </view>
        </view>
        
        <!-- æ—¶é—´åˆ†å¸ƒ -->
        <view class="time-distribution">
          <view class="distribution-title">æ‰¹æ”¹æ—¶é—´åˆ†å¸ƒ</view>
          <view class="time-slots">
            <view 
              wx:for="{{analytics.timeDistribution}}" 
              wx:key="hour"
              class="time-slot"
            >
              <view class="slot-bar">
                <view class="slot-fill" style="height: {{item.percentage}}%"></view>
              </view>
              <text class="slot-time">{{item.hour}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- å­¦ç”Ÿè¡¨ç°æ´å¯Ÿ -->
      <view class="insights-section">
        <view class="section-title">
          <text class="title-icon">ğŸ’¡</text>
          <text class="title-text">å­¦ç”Ÿè¡¨ç°æ´å¯Ÿ</text>
        </view>
        
        <view class="insights-cards">
          <!-- ä¼˜ç§€å­¦ç”Ÿ -->
          <view class="insight-card excellent">
            <view class="card-header">
              <text class="card-icon">â­</text>
              <text class="card-title">ä¼˜ç§€è¡¨ç°</text>
            </view>
            <view class="card-content">
              <text class="highlight-number">{{analytics.excellentCount}}</text>
              <text class="highlight-desc">å­¦ç”Ÿè·å¾—æä½³/ä¼˜ç§€è¯„ä»·</text>
            </view>
            <view class="card-trend up">
              <text class="trend-text">æ¯”ä¸Šæ¬¡æå‡ {{analytics.excellentTrend}}%</text>
            </view>
          </view>
          
          <!-- éœ€å…³æ³¨å­¦ç”Ÿ -->
          <view class="insight-card review">
            <view class="card-header">
              <text class="card-icon">ğŸ”</text>
              <text class="card-title">éœ€è¦å…³æ³¨</text>
            </view>
            <view class="card-content">
              <text class="highlight-number">{{analytics.reviewCount}}</text>
              <text class="highlight-desc">å­¦ç”Ÿéœ€è¦é¢å¤–è¾…å¯¼</text>
            </view>
            <view class="card-action" bindtap="showReviewStudents">
              <text class="action-text">æŸ¥çœ‹è¯¦æƒ…</text>
            </view>
          </view>
          
          <!-- è¿›æ­¥è¶‹åŠ¿ -->
          <view class="insight-card progress">
            <view class="card-header">
              <text class="card-icon">ğŸ“ˆ</text>
              <text class="card-title">æ•´ä½“è¶‹åŠ¿</text>
            </view>
            <view class="card-content">
              <text class="highlight-number">{{analytics.avgScore}}</text>
              <text class="highlight-desc">å¹³å‡åˆ†æ•°</text>
            </view>
            <view class="trend-indicator {{analytics.scoreTrend > 0 ? 'up' : 'down'}}">
              <text class="trend-icon">{{analytics.scoreTrend > 0 ? 'â†—' : 'â†˜'}}</text>
              <text class="trend-text">{{analytics.scoreTrend > 0 ? '+' : ''}}{{analytics.scoreTrend}}åˆ†</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- ä¸ªæ€§åŒ–å»ºè®® -->
      <view class="suggestions-section">
        <view class="section-title">
          <text class="title-icon">ğŸ¯</text>
          <text class="title-text">ä¸ªæ€§åŒ–å»ºè®®</text>
        </view>
        
        <view class="suggestion-list">
          <view 
            wx:for="{{analytics.suggestions}}" 
            wx:key="id"
            class="suggestion-item {{item.type}}"
          >
            <view class="suggestion-icon">{{item.icon}}</view>
            <view class="suggestion-content">
              <text class="suggestion-title">{{item.title}}</text>
              <text class="suggestion-desc">{{item.description}}</text>
            </view>
            <button class="suggestion-action" bindtap="applySuggestion" data-suggestion="{{item}}">
              {{item.actionText}}
            </button>
          </view>
        </view>
      </view>
      
    </scroll-view>
    
    <!-- åº•éƒ¨æ“ä½œ -->
    <view class="analytics-footer">
      <button class="footer-btn secondary" bindtap="exportReport">
        <text class="btn-icon">ğŸ“¥</text>
        <text class="btn-text">å¯¼å‡ºæŠ¥å‘Š</text>
      </button>
      <button class="footer-btn primary" bindtap="close">
        <text class="btn-text">çŸ¥é“äº†</text>
      </button>
    </view>
    
  </view>
</view>