# å‰ç«¯ä¸šåŠ¡æ¨¡å—æ ¸å¿ƒçº¦æŸæ–‡æ¡£

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡æ¨¡å—çº¦æŸ

### auth è®¤è¯æ¨¡å— (modules/auth/)

#### å¾®ä¿¡ç™»å½•æµç¨‹çº¦æŸ
```javascript
// æ ‡å‡†ç™»å½•æµç¨‹
wx.login() â†’ è·å–code 
â†’ åç«¯éªŒè¯ â†’ è¿”å›tokenå’Œç”¨æˆ·ä¿¡æ¯
â†’ wx.getUserProfile() â†’ è·å–å¤´åƒæ˜µç§°
â†’ æœ¬åœ°å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ â†’ è·³è½¬é¦–é¡µ
```

#### æƒé™éªŒè¯çº¦æŸ
**æ ¸å¿ƒéªŒè¯æ–¹æ³•**:
- `checkAuth()`: æ£€æŸ¥tokenæœ‰æ•ˆæ€§
- `checkPermission(action)`: æ£€æŸ¥å…·ä½“æ“ä½œæƒé™
- `refreshToken()`: tokenè¿‡æœŸè‡ªåŠ¨åˆ·æ–°
- `logout()`: æ¸…ç†æœ¬åœ°æ•°æ®ï¼Œè·³è½¬ç™»å½•é¡µ

#### Tokenç®¡ç†çº¦æŸ
```javascript
// Tokenå­˜å‚¨å’Œä½¿ç”¨è§„èŒƒ
const TOKEN_KEY = 'jwt_token';
const USER_INFO_KEY = 'user_info';

// è‡ªåŠ¨æ·»åŠ è®¤è¯å¤´
header: {
  'Authorization': `Bearer ${token}`,
  'Content-Type': 'application/json'
}
```

### task ä»»åŠ¡æ¨¡å— (modules/task/)

#### ä»»åŠ¡çŠ¶æ€è®¡ç®—çº¦æŸ
**å‰ç«¯çŠ¶æ€æ˜¾ç¤ºé€»è¾‘**ï¼ˆä¼˜å…ˆä½¿ç”¨åç«¯è®¡ç®—ç»“æœï¼‰:
1. **å¾…æäº¤**: æ— æäº¤è®°å½•æˆ–submission_count < 3
2. **å¾…æ‰¹æ”¹**: å·²æäº¤ä½†status !== 'graded'
3. **å·²æ‰¹æ”¹**: status === 'graded'ï¼Œæ˜¾ç¤ºå…·ä½“è¯„ä»·

#### ä»»åŠ¡æ•°æ®ç¼“å­˜çº¦æŸ
```javascript
// ä»»åŠ¡åˆ—è¡¨ç¼“å­˜ç­–ç•¥
const CACHE_KEY = 'task_list';
const CACHE_DURATION = 5 * 60 * 1000; // 5åˆ†é’Ÿ

// ç¼“å­˜æ›´æ–°è§¦å‘æ¡ä»¶
- ä¸‹æ‹‰åˆ·æ–°
- æäº¤ä½œä¸šæˆåŠŸ
- é¡µé¢onShowä¸”ç¼“å­˜è¿‡æœŸ
```

#### ä»»åŠ¡ç­›é€‰çº¦æŸ
- **å…¨éƒ¨**: æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡
- **è¿›è¡Œä¸­**: task.status === 'ongoing'
- **å·²ç»“æŸ**: task.status === 'ended'  
- **è¯¾ååŠ é¤**: task.task_type === 'extra'ï¼Œç½®é¡¶æ˜¾ç¤º

### submission æäº¤æ¨¡å— (modules/submission/)

#### å›¾ç‰‡ä¸Šä¼ çº¦æŸ
**ä¸Šä¼ æµç¨‹è§„èŒƒ**:
1. **é€‰æ‹©å›¾ç‰‡**: wx.chooseImageï¼Œæœ€å¤š6å¼ 
2. **å›¾ç‰‡å‹ç¼©**: è‡ªåŠ¨å‹ç¼©è‡³é€‚åˆå¤§å°ï¼Œä¿è¯æ¸…æ™°åº¦
3. **å¹¶å‘ä¸Šä¼ **: ä½¿ç”¨Promise.allï¼Œä½†é™åˆ¶å¹¶å‘æ•°â‰¤3
4. **è¿›åº¦åé¦ˆ**: å®æ—¶æ˜¾ç¤ºæ¯å¼ å›¾ç‰‡ä¸Šä¼ è¿›åº¦
5. **å¤±è´¥é‡è¯•**: è‡ªåŠ¨é‡è¯•3æ¬¡ï¼Œä»å¤±è´¥æ˜¾ç¤ºé‡è¯•æŒ‰é’®

#### æäº¤æ¬¡æ•°çº¦æŸ
```javascript
// æäº¤æ¬¡æ•°æ£€æŸ¥é€»è¾‘
const MAX_SUBMISSIONS = 3;

function canSubmit(submission) {
  // å¾…å¤ç›˜çŠ¶æ€ï¼šç³»ç»Ÿå·²é‡ç½®æäº¤æ¬¡æ•°
  if (submission.grade === 'å¾…å¤ç›˜') {
    return true;
  }
  // å…¶ä»–çŠ¶æ€ï¼šæ£€æŸ¥æäº¤æ¬¡æ•°
  return submission.submission_count < MAX_SUBMISSIONS;
}
```

#### æäº¤çŠ¶æ€ç®¡ç†
- **æäº¤ä¸­**: ç¦ç”¨æäº¤æŒ‰é’®ï¼Œæ˜¾ç¤ºä¸Šä¼ è¿›åº¦
- **æäº¤æˆåŠŸ**: æ›´æ–°æœ¬åœ°çŠ¶æ€ï¼Œè·³è½¬åˆ°å¾…æ‰¹æ”¹è§†å›¾
- **æäº¤å¤±è´¥**: æ¢å¤æŒ‰é’®çŠ¶æ€ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å’Œé‡è¯•é€‰é¡¹

### config é…ç½®æ¨¡å— (modules/config/)

#### APIé…ç½®çº¦æŸ
```javascript
// APIåŸºç¡€é…ç½®
const API_BASE_URL = 'https://api.domain.com';
const API_TIMEOUT = 30000; // 30ç§’è¶…æ—¶

// è¯·æ±‚æ‹¦æˆªå™¨é…ç½®
- è‡ªåŠ¨æ·»åŠ Authorizationå¤´
- è‡ªåŠ¨å¤„ç†tokenè¿‡æœŸ  
- ç»Ÿä¸€é”™è¯¯ç å¤„ç†
- è¯·æ±‚/å“åº”æ—¥å¿—è®°å½•
```

#### ç¯å¢ƒé…ç½®çº¦æŸ
```javascript
// å¤šç¯å¢ƒé…ç½®
const ENV_CONFIG = {
  development: {
    apiUrl: 'http://localhost:8000',
    debug: true
  },
  production: {
    apiUrl: 'https://api.production.com',
    debug: false  
  }
};
```

### speech è¯­éŸ³æ¨¡å— (modules/speech/)

#### è¯­éŸ³è½¬æ–‡å­—çº¦æŸ
**å¾®ä¿¡å®˜æ–¹APIä¼˜å…ˆä½¿ç”¨**:
```javascript
// ä½¿ç”¨å¾®ä¿¡å®˜æ–¹å½•éŸ³API
wx.getRecorderManager()
// é›†æˆé€šä¹‰åƒé—®APIè¿›è¡Œè¯­éŸ³è½¬æ–‡å­—
// è½¬å†™å‡†ç¡®ç‡è¦æ±‚â‰¥85%
```

#### å½•éŸ³æ§åˆ¶çº¦æŸ
- **å½•éŸ³æ—¶é•¿**: æœ€é•¿60ç§’ï¼Œè¶…æ—¶è‡ªåŠ¨åœæ­¢
- **å½•éŸ³æ ¼å¼**: ä½¿ç”¨å¾®ä¿¡æ”¯æŒçš„æ ¼å¼ï¼ˆmp3/aacï¼‰
- **æƒé™æ£€æŸ¥**: å½•éŸ³å‰æ£€æŸ¥éº¦å…‹é£æƒé™
- **çŠ¶æ€åé¦ˆ**: å½•éŸ³ä¸­æ˜¾ç¤ºéŸ³é‡æ³¢å½¢å’Œæ—¶é•¿

#### è½¬å†™æµç¨‹çº¦æŸ
```javascript
// è¯­éŸ³è½¬æ–‡å­—æµç¨‹
å½•éŸ³å®Œæˆ â†’ ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ â†’ è°ƒç”¨è½¬å†™API 
â†’ è·å–æ–‡å­—ç»“æœ â†’ æ”¯æŒç”¨æˆ·ç¼–è¾‘ â†’ ä¿å­˜æœ€ç»ˆç»“æœ
```

## ğŸ”§ æ¨¡å—é—´é€šä¿¡çº¦æŸ

### äº‹ä»¶æ€»çº¿æœºåˆ¶
```javascript
// å…¨å±€äº‹ä»¶ç®¡ç†
const EventBus = {
  // è®¢é˜…äº‹ä»¶
  on(event, callback) {},
  // å‘å¸ƒäº‹ä»¶  
  emit(event, data) {},
  // å–æ¶ˆè®¢é˜…
  off(event, callback) {}
};

// å…³é”®ä¸šåŠ¡äº‹ä»¶
EVENT_TYPES = {
  USER_LOGIN: 'user_login',
  TASK_UPDATED: 'task_updated', 
  SUBMISSION_SUCCESS: 'submission_success',
  PERMISSION_CHANGED: 'permission_changed'
}
```

### æ•°æ®å…±äº«çº¦æŸ
```javascript
// å…¨å±€æ•°æ®ç®¡ç†
const GlobalStore = {
  userInfo: null,      // ç”¨æˆ·åŸºç¡€ä¿¡æ¯
  permissions: {},     // æƒé™ä¿¡æ¯
  taskList: [],        // ä»»åŠ¡åˆ—è¡¨ç¼“å­˜
  learningData: {}     // å­¦ä¹ æ•°æ®ç¼“å­˜
};

// æ•°æ®æ›´æ–°é€šçŸ¥æœºåˆ¶
function updateGlobalData(key, data) {
  GlobalStore[key] = data;
  EventBus.emit(`${key}_updated`, data);
}
```

### æ¨¡å—ä¾èµ–å…³ç³»
```javascript
// æ¨¡å—ä¾èµ–å±‚æ¬¡
auth (åŸºç¡€å±‚) 
  â†“
config â†’ task â†’ submission (ä¸šåŠ¡å±‚)
  â†“  
speech (åŠŸèƒ½å±‚)

// é¿å…å¾ªç¯ä¾èµ–ï¼Œä¸Šå±‚æ¨¡å—å¯è°ƒç”¨ä¸‹å±‚æ¨¡å—
```

## ğŸ¨ ç”¨æˆ·ä½“éªŒçº¦æŸ

### é”™è¯¯å¤„ç†ç»Ÿä¸€è§„èŒƒ
```javascript
// æ ‡å‡†é”™è¯¯å¤„ç†æµç¨‹
function handleError(error) {
  // 1. æ—¥å¿—è®°å½•
  console.error('[Module Error]', error);
  
  // 2. ç”¨æˆ·å‹å¥½æç¤º
  const message = getErrorMessage(error);
  wx.showToast({
    title: message,
    icon: 'none',
    duration: 3000
  });
  
  // 3. é™çº§å¤„ç†
  return getErrorFallback(error);
}
```

### åŠ è½½çŠ¶æ€ç®¡ç†
- **é¡µé¢çº§loading**: æ•´é¡µæ•°æ®åŠ è½½æ—¶æ˜¾ç¤º
- **ç»„ä»¶çº§loading**: å±€éƒ¨æ•°æ®æ›´æ–°æ—¶æ˜¾ç¤º
- **æŒ‰é’®loading**: æ“ä½œæ‰§è¡Œä¸­ç¦ç”¨å¹¶æ˜¾ç¤ºloading
- **skeleton**: åˆ—è¡¨å’Œå¡ç‰‡çš„éª¨æ¶å±å ä½

### ç¼“å­˜ç­–ç•¥çº¦æŸ
```javascript
// ç¼“å­˜ç®¡ç†è§„èŒƒ
const CacheManager = {
  // è®¾ç½®ç¼“å­˜ï¼ˆå¸¦è¿‡æœŸæ—¶é—´ï¼‰
  set(key, data, duration = 5 * 60 * 1000) {},
  
  // è·å–ç¼“å­˜ï¼ˆæ£€æŸ¥è¿‡æœŸï¼‰
  get(key) {},
  
  // æ¸…ç†è¿‡æœŸç¼“å­˜
  cleanup() {},
  
  // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
  clear() {}
};
```

## âš ï¸ é‡è¦çº¦æŸæé†’

### å¾®ä¿¡å°ç¨‹åºé™åˆ¶
1. **ç½‘ç»œè¯·æ±‚**: å¿…é¡»é…ç½®åŸŸåç™½åå•ï¼Œä½¿ç”¨HTTPS
2. **æœ¬åœ°å­˜å‚¨**: åŒæ­¥å­˜å‚¨wx.setStorageSyncé™åˆ¶10MB
3. **é¡µé¢æ ˆæ·±åº¦**: æœ€å¤š10å±‚ï¼Œè¶…è¿‡éœ€è¦ä½¿ç”¨redirectTo
4. **åŒ…å¤§å°é™åˆ¶**: ä¸»åŒ…2MBï¼Œåˆ†åŒ…2MBï¼Œæ€»åŒ…20MB

### æ€§èƒ½ä¼˜åŒ–è¦æ±‚
1. **é¦–å±æ¸²æŸ“**: å…³é”®è·¯å¾„ä¼˜åŒ–ï¼Œé¦–å±æ—¶é—´<2ç§’
2. **å†…å­˜ä½¿ç”¨**: åŠæ—¶æ¸…ç†æœªä½¿ç”¨çš„æ•°æ®å’Œç›‘å¬å™¨
3. **ç½‘ç»œè¯·æ±‚**: åˆå¹¶è¯·æ±‚ï¼Œé¿å…é¢‘ç¹è°ƒç”¨
4. **å›¾ç‰‡å¤„ç†**: å‹ç¼©ä¸Šä¼ ï¼Œæ‡’åŠ è½½æ˜¾ç¤º

### å®‰å…¨çº¦æŸ
1. **æ•æ„Ÿæ•°æ®**: Tokenç­‰ä¿¡æ¯åŠ å¯†å­˜å‚¨
2. **æ¥å£è°ƒç”¨**: æ‰€æœ‰APIè¯·æ±‚æ·»åŠ è®¤è¯
3. **ç”¨æˆ·è¾“å…¥**: è¡¨å•æ•°æ®éªŒè¯å’Œè¿‡æ»¤
4. **é”™è¯¯æ—¥å¿—**: ä¸è®°å½•æ•æ„Ÿä¿¡æ¯åˆ°æ—¥å¿—

### å…¼å®¹æ€§å¤„ç†
1. **APIå…¼å®¹**: æ£€æŸ¥å¾®ä¿¡ç‰ˆæœ¬ï¼Œä½¿ç”¨å…¼å®¹API
2. **æœºå‹é€‚é…**: å¤„ç†ä¸åŒå±å¹•å°ºå¯¸å’Œæ€§èƒ½å·®å¼‚
3. **ç½‘ç»œç¯å¢ƒ**: å¼±ç½‘ç¯å¢ƒä¸‹çš„é™çº§å¤„ç†
4. **å¼‚å¸¸æ¢å¤**: æä¾›ç”¨æˆ·æ‰‹åŠ¨é‡è¯•å’Œé‡ç½®é€‰é¡¹

## ğŸ“‹ æ¨¡å—å¼€å‘æ£€æŸ¥æ¸…å•
- [ ] æ˜¯å¦éµå¾ªå¾®ä¿¡å®˜æ–¹APIä¼˜å…ˆåŸåˆ™
- [ ] æ˜¯å¦å®ç°å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶
- [ ] æ˜¯å¦æ·»åŠ åˆé€‚çš„ç¼“å­˜ç­–ç•¥
- [ ] æ˜¯å¦è€ƒè™‘æƒé™æ§åˆ¶å’Œå®‰å…¨çº¦æŸ
- [ ] æ˜¯å¦æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒåé¦ˆ
- [ ] æ˜¯å¦ç¬¦åˆæ€§èƒ½ä¼˜åŒ–è¦æ±‚
- [ ] æ˜¯å¦è€ƒè™‘å…¼å®¹æ€§å’Œé™çº§æ–¹æ¡ˆ