<!--è¯¾ååŠ é¤èµ„æ–™é¡µé¢-->
<view class="container">
  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <input 
        class="search-input"
        placeholder="æœç´¢èµ„æ–™..."
        value="{{keyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <text class="search-icon" bindtap="onSearch">ğŸ”</text>
    </view>
    
    <view class="filter-btn" bindtap="showFilter">
      <text class="filter-icon">ç­›é€‰</text>
    </view>
  </view>

  <!-- åˆ†ç±»å¿«æ·ç­›é€‰ -->
  <scroll-view class="category-tabs" scroll-x="true" show-scrollbar="false">
    <view class="category-tab-wrapper">
      <view 
        class="category-tab {{selectedCategory === '' ? 'active' : ''}}"
        bindtap="selectCategory"
        data-category=""
      >
        å…¨éƒ¨
      </view>
      <view 
        class="category-tab {{selectedCategory === item ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="*this"
        bindtap="selectCategory"
        data-category="{{item}}"
      >
        {{item}}
      </view>
    </view>
  </scroll-view>

  <!-- èµ„æ–™åˆ—è¡¨ -->
  <view class="materials-list">
    <view 
      class="material-card"
      wx:for="{{materials}}"
      wx:key="id"
      bindtap="viewMaterial"
      data-id="{{item.id}}"
    >
      <!-- èµ„æ–™å›¾ç‰‡/ç¼©ç•¥å›¾ -->
      <view class="material-thumbnail">
        <image 
          class="thumbnail-img"
          src="{{item.thumbnail_url || getDefaultThumbnail(item.material_type)}}"
          mode="aspectFill"
        />
        <view class="type-badge {{item.material_type}}">
          {{typeMap[item.material_type] || 'å…¶ä»–'}}
        </view>
        
        <!-- ä»˜è´¹æ ‡è¯† -->
        <view class="premium-badge" wx:if="{{item.required_subscription}}">
          <text>ä»˜è´¹</text>
        </view>
      </view>

      <!-- èµ„æ–™ä¿¡æ¯ -->
      <view class="material-info">
        <view class="material-header">
          <text class="material-title">{{item.title}}</text>
          <view class="material-actions">
            <text 
              class="action-btn collect {{item.is_collected ? 'active' : ''}}"
              bindtap="toggleCollect"
              data-id="{{item.id}}"
              data-collected="{{item.is_collected}}"
              catchtap="stopPropagation"
            >
              {{item.is_collected ? 'ğŸ’–' : 'ğŸ¤'}}
            </text>
            
            <text 
              class="action-btn like {{item.is_liked ? 'active' : ''}}"
              bindtap="toggleLike"
              data-id="{{item.id}}"
              data-liked="{{item.is_liked}}"
              catchtap="stopPropagation"
            >
              {{item.is_liked ? 'ğŸ‘' : 'ğŸ‘ğŸ»'}}
            </text>
          </view>
        </view>

        <text class="material-desc" wx:if="{{item.description}}">
          {{item.description}}
        </text>

        <view class="material-meta">
          <text class="meta-item">ğŸ‘ï¸ {{item.view_count}}</text>
          <text class="meta-item">ğŸ‘ {{item.like_count}}</text>
          <text class="meta-item" wx:if="{{item.duration}}">
            â±ï¸ {{formatDuration(item.duration)}}
          </text>
          <text class="meta-item">{{formatDate(item.created_at)}}</text>
        </view>

        <view class="material-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text 
            class="tag"
            wx:for="{{item.tags}}"
            wx:key="*this"
            wx:for-item="tag"
          >
            #{{tag}}
          </text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}">
      <text class="load-more-text" bindtap="loadMore">
        {{loading ? 'åŠ è½½ä¸­...' : 'ç‚¹å‡»åŠ è½½æ›´å¤š'}}
      </text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{materials.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ“š</text>
      <text class="empty-text">æš‚æ— èµ„æ–™</text>
      <text class="empty-desc">{{keyword ? 'æ¢ä¸ªå…³é”®è¯è¯•è¯•' : 'ç¨åå†æ¥çœ‹çœ‹å§'}}</text>
    </view>
  </view>
</view>

<!-- ç­›é€‰å¼¹çª— -->
<view class="filter-modal" wx:if="{{showFilterModal}}" bindtap="hideFilter">
  <view class="filter-content" catchtap="stopPropagation">
    <view class="filter-header">
      <text class="filter-title">ç­›é€‰æ¡ä»¶</text>
      <text class="filter-close" bindtap="hideFilter">Ã—</text>
    </view>

    <view class="filter-body">
      <view class="filter-group">
        <text class="filter-label">èµ„æ–™ç±»å‹</text>
        <view class="filter-options">
          <view 
            class="filter-option {{selectedType === '' ? 'active' : ''}}"
            bindtap="selectType"
            data-type=""
          >
            å…¨éƒ¨
          </view>
          <view 
            class="filter-option {{selectedType === item.value ? 'active' : ''}}"
            wx:for="{{typeOptions}}"
            wx:key="value"
            bindtap="selectType"
            data-type="{{item.value}}"
          >
            {{item.label}}
          </view>
        </view>
      </view>

      <view class="filter-group">
        <text class="filter-label">æ’åºæ–¹å¼</text>
        <view class="filter-options">
          <view 
            class="filter-option {{sortBy === item.value ? 'active' : ''}}"
            wx:for="{{sortOptions}}"
            wx:key="value"
            bindtap="selectSort"
            data-sort="{{item.value}}"
          >
            {{item.label}}
          </view>
        </view>
      </view>
    </view>

    <view class="filter-footer">
      <button class="filter-btn reset" bindtap="resetFilter">
        é‡ç½®
      </button>
      <button class="filter-btn apply" bindtap="applyFilter">
        åº”ç”¨ç­›é€‰
      </button>
    </view>
  </view>
</view>