<!--pages/admin/index/index.wxml - 教师端任务列表（和学生端相同）-->
<view class="container">
  <!-- 顶部标题和搜索 -->
  <view class="header-section">
    <view class="title-search-container">
      <view class="page-title">申论批改任务</view>
      <view class="search-btn" bindtap="onSearchToggle">
        <icon class="search-icon" type="search" size="20" color="#6b7280"/>
      </view>
    </view>
    
    <!-- 搜索输入框（展开时显示） -->
    <view class="search-input-container" wx:if="{{showSearch}}">
      <view class="search-input-box">
        <icon class="search-icon" type="search" size="16" color="#9ca3af"/>
        <input 
          class="search-input" 
          placeholder="搜索任务关键字"
          placeholder-class="search-placeholder"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearch"
          focus="{{showSearch}}"
        />
        <view wx:if="{{searchKeyword}}" class="clear-btn" bindtap="onClearSearch">
          <icon type="clear" size="14" color="#9ca3af"/>
        </view>
        <view class="cancel-btn" bindtap="onCancelSearch">取消</view>
      </view>
    </view>
  </view>

  <!-- 任务列表 -->
  <view class="task-list-container">
    <!-- 骨架屏 -->
    <skeleton show="{{loading}}" type="task-list" count="{{3}}"></skeleton>
    
    <!-- 任务列表 - 使用直接渲染（性能更好的虚拟列表后续优化） -->
    <scroll-view
      wx:if="{{!loading}}"
      class="task-scroll-container"
      style="height: {{listHeight}}px;"
      scroll-y
      enable-back-to-top
      refresher-enabled="{{true}}"
      refresher-triggered="{{refreshing}}"
      bindscrolltolower="onLoadMore"
      bindrefresherrefresh="onRefresh"
    >
      <view class="task-list-direct">
        <block wx:for="{{taskList}}" wx:key="id">
          <task-card 
            task="{{item}}"
            index="{{index}}"
            bind:click="onTaskClick"
            bind:toggleStatus="onToggleStatus"
            bind:share="onShareTask"
            bind:viewStats="onViewStats"
          />
        </block>
      </view>
    </scroll-view>
    
    <!-- 空状态 -->
    <empty-state
      wx:if="{{!loading && isEmpty}}"
      icon="📝"
      title="暂无任务"
      description="{{currentFilter === 'ongoing' ? '没有进行中的任务' : currentFilter === 'ended' ? '没有已结束的任务' : '老师还没有发布任务'}}"
      show-action="{{isTeacher}}"
      action-text="立即创建任务"
      action-type="primary"
      bind:actionClick="onCreateTask"
    />

    <!-- 加载更多 -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 没有更多 -->
    <view wx:if="{{!hasMore && taskList.length > 0}}" class="no-more">
      <text class="no-more-text">- 没有更多了 -</text>
    </view>

    <!-- 加载中 -->
    <view wx:if="{{loading && taskList.length === 0}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>
  </view>

  <!-- 教研管理入口按钮 -->
  <view class="teacher-admin-btn" bindtap="goToTeacherAdmin">
    <view class="admin-btn-icon">🎓</view>
    <view class="admin-btn-text">教研管理</view>
  </view>

  <!-- 底部安全区 -->
  <view class="safe-bottom"></view>
</view>

<!-- 升级引导组件 -->
<upgrade-guide 
  show="{{showUpgradeGuide}}"
  guideType="{{upgradeGuideType}}"
  featureName="任务详情查看"
  bind:close="onUpgradeGuideClose"
/>