<!-- ä»»åŠ¡è¯¦æƒ…ç®¡ç†é¡µ -->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else>
    <!-- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ -->
    <view class="task-info-card">
      <view class="card-header">
        <view class="task-title">{{taskInfo.title}}</view>
        <view class="task-status {{taskInfo.status}}">
          {{taskInfo.status === 'ongoing' ? 'è¿›è¡Œä¸­' : (taskInfo.status === 'ended' ? 'å·²ç»“æŸ' : 'è‰ç¨¿')}}
        </view>
      </view>
      
      <view class="task-meta">
        <view class="meta-item">
          <text class="meta-label">è¯¾ç¨‹ç±»å‹ï¼š</text>
          <text class="meta-value course-type">
            {{taskInfo.course}}
          </text>
        </view>
        <view class="meta-item">
          <text class="meta-label">å‘å¸ƒæ—¶é—´ï¼š</text>
          <text class="meta-value">{{taskInfo.created_at}}</text>
        </view>
        <view class="meta-item" wx:if="{{taskInfo.deadline}}">
          <text class="meta-label">æˆªæ­¢æ—¶é—´ï¼š</text>
          <text class="meta-value {{taskInfo.isOverdue ? 'overdue' : ''}}">{{taskInfo.deadline}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-label">åˆ›å»ºè€å¸ˆï¼š</text>
          <text class="meta-value">{{taskInfo.creator_name}}</text>
        </view>
      </view>

      <view class="task-description" wx:if="{{taskInfo.description}}">
        <view class="desc-title">ä»»åŠ¡æè¿°</view>
        <view class="desc-content">{{taskInfo.description}}</view>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="stats-overview">
      <view class="stats-item">
        <text class="stats-number">{{statisticsData.total_students}}</text>
        <text class="stats-label">æ€»å­¦ç”Ÿæ•°</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-number">{{statisticsData.submitted_count}}</text>
        <text class="stats-label">å·²æäº¤</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-number">{{statisticsData.graded_count}}</text>
        <text class="stats-label">å·²æ‰¹æ”¹</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-number">{{statisticsData.completion_rate}}%</text>
        <text class="stats-label">å®Œæˆç‡</text>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’®åŒº -->
    <view class="action-buttons">
      <button class="action-btn primary" bindtap="onStartGrading" wx:if="{{statisticsData.submitted_count > 0}}">
        <text class="btn-icon">âœï¸</text>
        <text class="btn-text">å¼€å§‹æ‰¹æ”¹</text>
      </button>
      <button class="action-btn warning" bindtap="onDeleteTask" wx:if="{{taskInfo.status === 'draft'}}">
        <text class="btn-icon">ğŸ—‘ï¸</text>
        <text class="btn-text">åˆ é™¤ä»»åŠ¡</text>
      </button>
    </view>

    <!-- å­¦ç”Ÿæäº¤åˆ—è¡¨ -->
    <view class="submissions-section">
      <view class="section-header">
        <view class="section-title">å­¦ç”Ÿæäº¤æƒ…å†µ</view>
        <view class="filter-tabs">
          <text 
            class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" 
            bindtap="onFilterChange"
            data-filter="all"
          >å…¨éƒ¨</text>
          <text 
            class="filter-tab {{currentFilter === 'submitted' ? 'active' : ''}}" 
            bindtap="onFilterChange"
            data-filter="submitted"
          >å·²æäº¤</text>
          <text 
            class="filter-tab {{currentFilter === 'graded' ? 'active' : ''}}" 
            bindtap="onFilterChange"
            data-filter="graded"
          >å·²æ‰¹æ”¹</text>
        </view>
      </view>

      <!-- å­¦ç”Ÿåˆ—è¡¨ -->
      <view class="submissions-list">
        <view 
          class="submission-card" 
          wx:for="{{submissionsList}}" 
          wx:key="student_id"
          bindtap="onSubmissionClick"
          data-submission="{{item}}"
        >
          <view class="submission-basic">
            <view class="student-info">
              <image 
                class="student-avatar" 
                src="{{item.student_avatar}}" 
                mode="aspectFill"
                wx:if="{{item.student_avatar}}"
              ></image>
              <view class="avatar-placeholder" wx:else>
                <text class="avatar-icon">ğŸ‘¤</text>
              </view>
              <view class="student-details">
                <view class="student-name">{{item.student_name}}</view>
                <view class="submit-time" wx:if="{{item.submitted_at}}">
                  æäº¤æ—¶é—´ï¼š{{item.submitted_at}}
                </view>
                <view class="submit-time pending" wx:else>
                  å°šæœªæäº¤
                </view>
              </view>
            </view>
            <view class="submission-status">
              <view class="status-badge {{item.status}}">
                {{item.status === 'graded' ? 'å·²æ‰¹æ”¹' : (item.status === 'submitted' ? 'å·²æäº¤' : 'æœªæäº¤')}}
              </view>
              <view class="grade-info" wx:if="{{item.status === 'graded'}}">
                <text class="grade-value {{item.evaluation}}">{{item.evaluation}}</text>
              </view>
            </view>
          </view>

          <!-- æäº¤å†…å®¹é¢„è§ˆ -->
          <view class="submission-preview" wx:if="{{item.submission_images && item.submission_images.length > 0}}">
            <view class="preview-images">
              <image 
                class="preview-image" 
                src="{{image}}" 
                mode="aspectFill"
                wx:for="{{item.submission_images}}" 
                wx:for-item="image"
                wx:key="*this"
              ></image>
              <view class="image-count" wx:if="{{item.submission_images.length > 3}}">
                +{{item.submission_images.length - 3}}
              </view>
            </view>
          </view>

          <view class="submission-arrow">
            <text class="arrow-icon">â€º</text>
          </view>
        </view>

        <!-- åŠ è½½æ›´å¤š -->
        <view class="loading-more" wx:if="{{loadingMore}}">
          <view class="loading-spinner"></view>
          <text class="loading-text">åŠ è½½æ›´å¤š...</text>
        </view>

        <!-- æ²¡æœ‰æ›´å¤š -->
        <view class="no-more" wx:elif="{{!hasMore && submissionsList.length > 0}}">
          <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{isEmpty}}">
        <view class="empty-icon">ğŸ“</view>
        <view class="empty-text">{{getEmptyText()}}</view>
        <view class="empty-hint">{{getEmptyHint()}}</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions" wx:if="{{!loading}}">
    <button class="bottom-btn secondary" bindtap="onExportData">
      <text class="btn-icon">ğŸ“Š</text>
      <text class="btn-text">å¯¼å‡ºæ•°æ®</text>
    </button>
    <button class="bottom-btn primary" bindtap="onSendReminder" wx:if="{{statisticsData.pending_count > 0}}">
      <text class="btn-icon">ğŸ“¢</text>
      <text class="btn-text">å‘é€å‚¬åŠ</text>
    </button>
  </view>
</view>