<!-- å­¦ç”Ÿæ€»åˆ—è¡¨é¡µ -->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-wrapper">
      <input 
        class="search-input" 
        placeholder="æœç´¢å­¦ç”Ÿæ˜µç§°æˆ–æ‰‹æœºå·..."
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <text class="search-icon">ğŸ”</text>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="stats-overview">
    <view class="stats-item">
      <view class="stats-number">{{totalStudents}}</view>
      <view class="stats-label">å­¦ç”Ÿæ€»æ•°</view>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item">
      <view class="stats-number">{{paidStudents}}</view>
      <view class="stats-label">ä»˜è´¹å­¦å‘˜</view>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item">
      <view class="stats-number">{{trialStudents}}</view>
      <view class="stats-label">è¯•ç”¨å­¦å‘˜</view>
    </view>
  </view>

  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <scroll-view class="filter-scroll" scroll-x>
      <view class="filter-list">
        <view 
          class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
          data-filter="all"
          bindtap="onFilterChange"
        >
          å…¨éƒ¨å­¦å‘˜
        </view>
        <view 
          class="filter-tab {{currentFilter === 'paid' ? 'active' : ''}}"
          data-filter="paid"
          bindtap="onFilterChange"
        >
          ä»˜è´¹å­¦å‘˜
        </view>
        <view 
          class="filter-tab {{currentFilter === 'trial' ? 'active' : ''}}"
          data-filter="trial"
          bindtap="onFilterChange"
        >
          è¯•ç”¨å­¦å‘˜
        </view>
        <view 
          class="filter-tab {{currentFilter === 'active' ? 'active' : ''}}"
          data-filter="active"
          bindtap="onFilterChange"
        >
          æ´»è·ƒå­¦å‘˜
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å­¦ç”Ÿåˆ—è¡¨ -->
  <scroll-view 
    class="student-list"
    scroll-y
    enable-back-to-top
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
  >
    <!-- å­¦ç”Ÿä¿¡æ¯å¡ç‰‡ -->
    <view wx:for="{{studentList}}" wx:key="id" class="student-card" bindtap="onStudentClick" data-student="{{item}}">
      <view class="student-basic-info">
        <!-- å¤´åƒ -->
        <view class="avatar-wrapper">
          <image class="student-avatar" src="{{item.avatar}}" mode="aspectFill" wx:if="{{item.avatar}}"/>
          <view class="avatar-placeholder" wx:else>
            <text class="avatar-icon">ğŸ‘¤</text>
          </view>
          <view class="permission-badge {{item.permission_type}}">
            {{item.permission_type === 'paid' ? 'VIP' : 'è¯•ç”¨'}}
          </view>
        </view>

        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <view class="student-details">
          <view class="student-name">{{item.nickname || 'æœªè®¾ç½®æ˜µç§°'}}</view>
          <view class="student-meta">
            <view class="meta-item">
              <text class="meta-label">æ³¨å†Œæ—¶é—´ï¼š</text>
              <text class="meta-value">{{item.created_at}}</text>
            </view>
            <view class="meta-item" wx:if="{{item.last_active}}">
              <text class="meta-label">æœ€è¿‘æ´»è·ƒï¼š</text>
              <text class="meta-value">{{item.last_active}}</text>
            </view>
            <view class="meta-item" wx:if="{{item.permission_expire}}">
              <text class="meta-label">æƒé™åˆ°æœŸï¼š</text>
              <text class="meta-value {{item.isExpiringSoon ? 'warning' : ''}}">{{item.permission_expire}}</text>
            </view>
          </view>
        </view>

        <!-- æ“ä½œç®­å¤´ -->
        <view class="action-arrow">
          <text class="arrow-icon">â€º</text>
        </view>
      </view>

      <!-- å­¦ä¹ ç»Ÿè®¡ -->
      <view class="student-stats">
        <view class="stat-group">
          <view class="stat-item">
            <view class="stat-number">{{item.stats.total_submissions || 0}}</view>
            <view class="stat-label">æ€»æäº¤</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{item.stats.completed_tasks || 0}}</view>
            <view class="stat-label">å·²å®Œæˆ</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{item.stats.average_score || 0}}</view>
            <view class="stat-label">å¹³å‡åˆ†</view>
          </view>
        </view>
        
        <!-- æœ€è¿‘è¡¨ç°æ ‡ç­¾ -->
        <view wx:if="{{item.recentPerformance}}" class="performance-tag {{item.recentPerformance.type}}">
          {{item.recentPerformance.text}}
        </view>
      </view>

      <!-- å¿«é€Ÿæ“ä½œ -->
      <view class="quick-actions" catchtap="onActionTap">
        <view class="quick-btn" data-action="archive" data-student="{{item}}" bindtap="onQuickAction">
          <text class="btn-icon">ğŸ“‹</text>
          <text class="btn-text">æ¡£æ¡ˆ</text>
        </view>
        <view class="quick-btn" data-action="contact" data-student="{{item}}" bindtap="onQuickAction">
          <text class="btn-icon">ğŸ’¬</text>
          <text class="btn-text">è”ç³»</text>
        </view>
        <view class="quick-btn" data-action="permission" data-student="{{item}}" bindtap="onQuickAction">
          <text class="btn-icon">ğŸ”‘</text>
          <text class="btn-text">æƒé™</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && studentList.length > 0}}" class="no-more">
      <text class="no-more-text">- æ²¡æœ‰æ›´å¤šäº† -</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <empty-state
      show="{{isEmpty && !loading}}"
      icon="ğŸ‘¥"
      title="{{getEmptyText()}}"
      description="{{getEmptyHint()}}"
      show-action="{{currentFilter === 'all'}}"
      action-text="åˆ·æ–°æ•°æ®"
      action-type="outline"
      bind:actionClick="onRefresh"
    ></empty-state>

    <!-- éª¨æ¶å± -->
    <skeleton show="{{loading && studentList.length === 0}}" type="student-list" count="{{4}}"></skeleton>
  </scroll-view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab-actions">
    <view class="fab-btn" bindtap="exportStudentList">
      <text class="fab-icon">ğŸ“¤</text>
      <text class="fab-text">å¯¼å‡º</text>
    </view>
  </view>
</view>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-bottom"></view>