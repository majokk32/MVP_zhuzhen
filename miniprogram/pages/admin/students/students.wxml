<!-- å­¦ç”Ÿç®¡ç†é¡µé¢ -->
<view class="container">
  <!-- å¤´éƒ¨ç»Ÿè®¡ -->
  <view class="stats-header">
    <view class="header-title">
      <text class="title-icon">ğŸ‘¥</text>
      <text class="title-text">å­¦ç”Ÿç®¡ç†</text>
    </view>
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-number">{{totalStudents}}</view>
        <view class="stat-label">æ€»å­¦å‘˜</view>
      </view>
      <view class="stat-item">
        <view class="stat-number paid">{{paidStudents}}</view>
        <view class="stat-label">ä»˜è´¹</view>
      </view>
      <view class="stat-item">
        <view class="stat-number trial">{{trialStudents}}</view>
        <view class="stat-label">è¯•ç”¨</view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰æŒ‰é’® -->
  <view class="filter-buttons">
    <view class="filter-btn-group">
      <button 
        class="filter-btn {{currentFilter === 'all' ? 'active' : ''}}"
        data-filter="all"
        bindtap="onFilterChange"
      >
        <text class="filter-icon">ğŸ“‹</text>å…¨éƒ¨
      </button>
      <button 
        class="filter-btn {{currentFilter === 'paid' ? 'active' : ''}}"
        data-filter="paid"
        bindtap="onFilterChange"
      >
        <text class="filter-icon">âœ…</text>ä»˜è´¹
      </button>
      <button 
        class="filter-btn {{currentFilter === 'trial' ? 'active' : ''}}"
        data-filter="trial"
        bindtap="onFilterChange"
      >
        <text class="filter-icon">âŒ</text>è¯•ç”¨
      </button>
    </view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-section">
    <view class="search-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢å­¦ç”Ÿå§“åæˆ–æ‰‹æœºå·"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <view wx:if="{{searchKeyword}}" class="search-clear" bindtap="onSearchClear">
        <text class="clear-icon">Ã—</text>
      </view>
    </view>
  </view>

  <!-- å­¦ç”Ÿåˆ—è¡¨ -->
  <scroll-view 
    class="student-list"
    scroll-y
    enable-back-to-top
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
  >
    <!-- å­¦ç”Ÿå¡ç‰‡ -->
    <view wx:for="{{studentList}}" wx:key="id" class="student-card" data-student="{{item}}">
      <view class="student-main-info">
        <view class="student-avatar-section">
          <!-- å¤´åƒ -->
          <view class="avatar-container">
            <image 
              class="student-avatar" 
              src="{{item.avatar}}" 
              mode="aspectFill" 
              wx:if="{{item.avatar && item.avatar !== 'https://example.com/default_avatar.jpg'}}"
              lazy-load="true" 
              binderror="onImageError"
            />
            <view class="avatar-placeholder" wx:else>
              <text class="avatar-icon">ğŸ‘¤</text>
            </view>
            <!-- åœ¨çº¿çŠ¶æ€æŒ‡ç¤ºå™¨ -->
            <view class="status-indicator {{item.permission_type === 'paid' ? 'online' : 'offline'}}"></view>
          </view>
          
          <!-- å­¦ç”Ÿä¿¡æ¯ -->
          <view class="student-info">
            <view class="student-name">{{item.nickname || 'æœªè®¾ç½®æ˜µç§°'}}</view>
            <view class="student-stats-text">
              æ€»æäº¤ï¼š{{item.stats.total_submissions || 0}}æ¬¡ | æœ€åç™»å½•ï¼š{{item.last_active}}
            </view>
          </view>
        </view>

        <!-- çŠ¶æ€å’Œæ“ä½œ -->
        <view class="student-actions">
          <view class="permission-status {{item.permission_type === 'paid' ? 'authorized' : 'unauthorized'}}">
            {{item.permission_type === 'paid' ? 'ä»˜è´¹' : 'è¯•ç”¨'}}
          </view>
          <button class="archive-btn {{item.permission_type === 'paid' ? 'active' : 'inactive'}}" bindtap="viewStudentArchive" data-student="{{item}}">
            æ¡£æ¡ˆ
          </button>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && studentList.length > 0}}" class="no-more">
      <text class="no-more-text">- æ²¡æœ‰æ›´å¤šäº† -</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <empty-state
      show="{{isEmpty && !loading}}"
      icon="ğŸ‘¥"
      title="{{getEmptyText()}}"
      description="{{getEmptyHint()}}"
      show-action="{{currentFilter === 'all'}}"
      action-text="åˆ·æ–°æ•°æ®"
      action-type="outline"
      bind:actionClick="onRefresh"
    ></empty-state>

    <!-- éª¨æ¶å± -->
    <skeleton show="{{loading && studentList.length === 0}}" type="student-list" count="{{4}}"></skeleton>
  </scroll-view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab-actions">
    <view class="fab-btn" bindtap="exportStudentList">
      <text class="fab-icon">ğŸ“¤</text>
      <text class="fab-text">å¯¼å‡º</text>
    </view>
  </view>
</view>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-bottom"></view>