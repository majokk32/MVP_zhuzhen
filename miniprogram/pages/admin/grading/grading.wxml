<!-- æ‰¹æ”¹ä»»åŠ¡å°é¡µé¢ -->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ç»Ÿè®¡ -->
  <view class="stats-header">
    <view class="stats-title">æ‰¹æ”¹å·¥ä½œå°</view>
    <view class="stats-summary">
      <view class="summary-item">
        <view class="summary-number">{{totalPending}}</view>
        <view class="summary-label">å¾…æ‰¹æ”¹</view>
      </view>
      <view class="summary-divider"></view>
      <view class="summary-item">
        <view class="summary-number">{{todayReviewed}}</view>
        <view class="summary-label">ä»Šæ—¥å·²æ‰¹æ”¹</view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <scroll-view class="filter-scroll" scroll-x>
      <view class="filter-list">
        <view 
          class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
          data-filter="all"
          bindtap="onFilterChange"
        >
          å…¨éƒ¨ä»»åŠ¡
        </view>
        <view 
          class="filter-tab {{currentFilter === 'ongoing' ? 'active' : ''}}"
          data-filter="ongoing"
          bindtap="onFilterChange"
        >
          å¾…æ‰¹æ”¹
        </view>
        <view 
          class="filter-tab {{currentFilter === 'completed' ? 'active' : ''}}"
          data-filter="completed"
          bindtap="onFilterChange"
        >
          å·²å®Œæˆ
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <scroll-view 
    class="grading-list"
    scroll-y
    enable-back-to-top
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
  >
    <!-- æ‰¹æ”¹ä»»åŠ¡å¡ç‰‡ -->
    <view wx:for="{{taskList}}" wx:key="id" class="grading-task-card" bindtap="onTaskClick" data-task="{{item}}">
      <!-- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ -->
      <view class="task-header">
        <view class="task-title-area">
          <view class="task-title">{{item.title}}</view>
          <view class="task-status status-{{item.status}}">{{item.statusText}}</view>
        </view>
        <view class="task-date">{{item.course_date}}</view>
      </view>

      <!-- æ‰¹æ”¹è¿›åº¦æŒ‡ç¤ºå™¨ -->
      <view class="progress-indicator">
        <view class="progress-stats">
          <view class="stat-group submitted">
            <view class="stat-number">{{item.stats.submitted || 0}}</view>
            <view class="stat-label">å·²æäº¤</view>
          </view>
          <view class="stat-divider">|</view>
          <view class="stat-group pending">
            <view class="stat-number">{{item.stats.pending || 0}}</view>
            <view class="stat-label">å¾…æ‰¹æ”¹</view>
          </view>
          <view class="stat-divider">|</view>
          <view class="stat-group reviewed">
            <view class="stat-number">{{item.stats.reviewed || 0}}</view>
            <view class="stat-label">å·²æ‰¹æ”¹</view>
          </view>
        </view>
        
        <!-- è¿›åº¦æ¡ -->
        <view class="progress-bar">
          <view class="progress-track">
            <view 
              class="progress-fill" 
              style="width: {{item.progressPercent}}%"
            ></view>
          </view>
          <view class="progress-text">{{item.progressPercent}}%</view>
        </view>
      </view>

      <!-- ç´§æ€¥æ ‡è¯† -->
      <view wx:if="{{item.isUrgent}}" class="urgent-badge">
        <text class="urgent-icon">âš¡</text>
        <text class="urgent-text">ç´§æ€¥</text>
      </view>

      <!-- å¿«é€Ÿæ“ä½œ -->
      <view class="quick-actions" catchtap="onActionTap">
        <view wx:if="{{item.stats.pending > 0}}" class="quick-btn primary" data-action="start" data-task="{{item}}" bindtap="onQuickAction">
          <text class="btn-icon">ğŸ–Šï¸</text>
          <text class="btn-text">å¼€å§‹æ‰¹æ”¹</text>
        </view>
        <view class="quick-btn" data-action="view" data-task="{{item}}" bindtap="onQuickAction">
          <text class="btn-icon">ğŸ“Š</text>
          <text class="btn-text">æŸ¥çœ‹ç»Ÿè®¡</text>
        </view>
        <view class="quick-btn" data-action="export" data-task="{{item}}" bindtap="onQuickAction">
          <text class="btn-icon">ğŸ“¤</text>
          <text class="btn-text">å¯¼å‡º</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && taskList.length > 0}}" class="no-more">
      <text class="no-more-text">- æ²¡æœ‰æ›´å¤šäº† -</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{isEmpty && !loading}}" class="empty-state">
      <image class="empty-image" src="/assets/images/empty-grading.png" mode="aspectFit" lazy-load="true" binderror="onImageError"></image>
      <text class="empty-text">{{getEmptyText()}}</text>
      <text class="empty-hint">{{getEmptyHint()}}</text>
      <button class="empty-btn" bindtap="goToTaskManage" wx:if="{{currentFilter === 'all'}}">
        å»åˆ›å»ºä»»åŠ¡
      </button>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading && taskList.length === 0}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </scroll-view>

  <!-- æ‰¹é‡æ“ä½œæµ®åŠ¨æŒ‰é’® -->
  <view wx:if="{{taskList.length > 0}}" class="batch-actions">
    <view class="batch-btn" bindtap="batchExport">
      <text class="batch-icon">ğŸ“¥</text>
      <text class="batch-text">æ‰¹é‡å¯¼å‡º</text>
    </view>
    <view class="batch-btn" bindtap="batchNotify">
      <text class="batch-icon">ğŸ“¢</text>
      <text class="batch-text">æ‰¹é‡é€šçŸ¥</text>
    </view>
  </view>
</view>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-bottom"></view>