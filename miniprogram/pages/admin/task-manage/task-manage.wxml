<!-- è¯¾ç¨‹ä½œä¸šç®¡ç†é¡µ -->
<view class="container">
  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="search-filter-bar">
    <view class="search-wrapper">
      <input 
        class="search-input" 
        placeholder="æœç´¢è¯¾ç¨‹æˆ–ä»»åŠ¡åç§°..."
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <text class="search-icon">ğŸ”</text>
    </view>
    
    <view class="filter-tabs">
      <scroll-view class="filter-scroll" scroll-x>
        <view class="filter-list">
          <view 
            class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
            data-filter="all"
            bindtap="onFilterChange"
          >
            å…¨éƒ¨
          </view>
          <view 
            class="filter-tab {{currentFilter === 'ongoing' ? 'active' : ''}}"
            data-filter="ongoing"
            bindtap="onFilterChange"
          >
            è¿›è¡Œä¸­
          </view>
          <view 
            class="filter-tab {{currentFilter === 'ended' ? 'active' : ''}}"
            data-filter="ended"
            bindtap="onFilterChange"
          >
            å·²ç»“æŸ
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <scroll-view 
    class="task-list"
    scroll-y
    enable-back-to-top
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
  >
    <!-- ä»»åŠ¡å¡ç‰‡ -->
    <view wx:for="{{taskList}}" wx:key="id" class="task-card status-{{item.status}}" bindtap="onTaskClick" data-task="{{item}}">
      <view class="task-content">
        <view class="task-header">
          <view class="task-title">{{item.title}}</view>
          <view class="task-status status-{{item.status}}">{{item.statusText}}</view>
        </view>
        
        <view class="task-meta">
          <text class="meta-label">åˆ›å»ºæ—¶é—´ï¼š</text>
          <text class="meta-value">{{item.created_at}}</text>
        </view>
        <view class="task-meta" wx:if="{{item.course_date}}">
          <text class="meta-label">ç›´æ’­æ—¶é—´ï¼š</text>
          <text class="meta-value">{{item.course_date}}</text>
        </view>

        <!-- ç®€åŒ–çš„ç»Ÿè®¡ä¿¡æ¯ -->
        <view class="task-stats">
          <view class="stat-item">
            <text class="stat-number">{{item.stats.submitted || 0}}</text>
            <text class="stat-label">å·²æäº¤</text>
          </view>
          <view class="stat-divider">/</view>
          <view class="stat-item">
            <text class="stat-number">{{item.stats.reviewed || 0}}</text>
            <text class="stat-label">å·²æ‰¹æ”¹</text>
          </view>
          <view class="stat-divider">/</view>
          <view class="stat-item">
            <text class="stat-number">{{item.stats.total_students || 0}}</text>
            <text class="stat-label">æ€»å­¦ç”Ÿ</text>
          </view>
        </view>
      </view>
      
      <!-- å³ç®­å¤´ -->
      <view class="task-arrow">
        <text class="arrow-icon">â€º</text>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && taskList.length > 0}}" class="no-more">
      <text class="no-more-text">- æ²¡æœ‰æ›´å¤šäº† -</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{isEmpty && !loading}}" class="empty-state">
      <image class="empty-image" src="/assets/images/empty-tasks.png" mode="aspectFit"></image>
      <text class="empty-text">{{getEmptyText()}}</text>
      <text class="empty-hint">{{getEmptyHint()}}</text>
      <button class="empty-btn" bindtap="onCreateTask" wx:if="{{currentFilter === 'all'}}">
        ç«‹å³åˆ›å»ºä»»åŠ¡
      </button>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading && taskList.length === 0}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </scroll-view>

  <!-- åˆ›å»ºä»»åŠ¡æµ®åŠ¨æŒ‰é’® -->
  <view class="fab-container">
    <view class="fab-btn" bindtap="onCreateTask">
      <text class="fab-icon">+</text>
      <text class="fab-text">æ–°å»ºä»»åŠ¡</text>
    </view>
  </view>
</view>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-bottom"></view>