<!-- è¯¾ç¨‹ä½œä¸šç®¡ç†é¡µ -->
<view class="container">
  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="search-filter-bar">
    <view class="search-wrapper">
      <input 
        class="search-input" 
        placeholder="æœç´¢è¯¾ç¨‹æˆ–ä»»åŠ¡åç§°..."
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <text class="search-icon">ğŸ”</text>
    </view>
    
    <view class="filter-tabs">
      <scroll-view class="filter-scroll" scroll-x>
        <view class="filter-list">
          <view 
            class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
            data-filter="all"
            bindtap="onFilterChange"
          >
            å…¨éƒ¨
          </view>
          <view 
            class="filter-tab {{currentFilter === 'draft' ? 'active' : ''}}"
            data-filter="draft"
            bindtap="onFilterChange"
          >
            è‰ç¨¿
          </view>
          <view 
            class="filter-tab {{currentFilter === 'ongoing' ? 'active' : ''}}"
            data-filter="ongoing"
            bindtap="onFilterChange"
          >
            è¿›è¡Œä¸­
          </view>
          <view 
            class="filter-tab {{currentFilter === 'ended' ? 'active' : ''}}"
            data-filter="ended"
            bindtap="onFilterChange"
          >
            å·²ç»“æŸ
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <scroll-view 
    class="task-list"
    scroll-y
    enable-back-to-top
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
  >
    <!-- ä»»åŠ¡å¡ç‰‡ -->
    <view wx:for="{{taskList}}" wx:key="id" class="task-manage-card" bindtap="onTaskClick" data-task="{{item}}">
      <view class="task-header">
        <view class="task-title">{{item.title}}</view>
        <view class="task-status status-{{item.status}}">{{item.statusText}}</view>
      </view>
      
      <view class="task-meta">
        <view class="meta-item">
          <text class="meta-label">åˆ›å»ºæ—¶é—´ï¼š</text>
          <text class="meta-value">{{item.created_at}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-label">ç›´æ’­æ—¶é—´ï¼š</text>
          <text class="meta-value">{{item.course_date || 'æœªè®¾ç½®'}}</text>
        </view>
      </view>

      <!-- è¿›åº¦ç»Ÿè®¡ -->
      <view class="task-progress">
        <view class="progress-item">
          <view class="progress-number">{{item.stats.submitted || 0}}</view>
          <view class="progress-label">å·²æäº¤</view>
        </view>
        <view class="progress-divider">/</view>
        <view class="progress-item">
          <view class="progress-number">{{item.stats.reviewed || 0}}</view>
          <view class="progress-label">å·²æ‰¹æ”¹</view>
        </view>
        <view class="progress-divider">/</view>
        <view class="progress-item">
          <view class="progress-number">{{item.stats.total_students || 0}}</view>
          <view class="progress-label">æ€»å­¦ç”Ÿ</view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="task-actions" catchtap="onActionTap">
        <view class="action-btn" data-action="edit" data-task="{{item}}" bindtap="onActionClick">
          <text class="action-icon">âœï¸</text>
          <text class="action-text">ç¼–è¾‘</text>
        </view>
        <view wx:if="{{item.status === 'draft'}}" class="action-btn primary" data-action="publish" data-task="{{item}}" bindtap="onActionClick">
          <text class="action-icon">ğŸš€</text>
          <text class="action-text">å‘å¸ƒ</text>
        </view>
        <view wx:else class="action-btn" data-action="view" data-task="{{item}}" bindtap="onActionClick">
          <text class="action-icon">ğŸ‘ï¸</text>
          <text class="action-text">æŸ¥çœ‹</text>
        </view>
        <view wx:if="{{item.status !== 'draft'}}" class="action-btn" data-action="share" data-task="{{item}}" bindtap="onActionClick">
          <text class="action-icon">ğŸ“¤</text>
          <text class="action-text">åˆ†äº«</text>
        </view>
        <view class="action-btn danger" data-action="delete" data-task="{{item}}" bindtap="onActionClick">
          <text class="action-icon">ğŸ—‘ï¸</text>
          <text class="action-text">åˆ é™¤</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && taskList.length > 0}}" class="no-more">
      <text class="no-more-text">- æ²¡æœ‰æ›´å¤šäº† -</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{isEmpty && !loading}}" class="empty-state">
      <image class="empty-image" src="/assets/images/empty-tasks.png" mode="aspectFit"></image>
      <text class="empty-text">{{getEmptyText()}}</text>
      <text class="empty-hint">{{getEmptyHint()}}</text>
      <button class="empty-btn" bindtap="onCreateTask" wx:if="{{currentFilter === 'all'}}">
        ç«‹å³åˆ›å»ºä»»åŠ¡
      </button>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading && taskList.length === 0}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </scroll-view>

  <!-- åˆ›å»ºä»»åŠ¡æµ®åŠ¨æŒ‰é’® -->
  <view class="fab-container">
    <view class="fab-btn" bindtap="onCreateTask">
      <text class="fab-icon">+</text>
    </view>
  </view>
</view>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-bottom"></view>