<!-- 课程作业管理页 -->
<view class="container">
  <!-- 搜索和筛选栏 -->
  <view class="search-filter-bar">
    <view class="search-wrapper">
      <input 
        class="search-input" 
        placeholder="搜索课程或任务名称..."
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <text class="search-icon">🔍</text>
    </view>
    
    <view class="filter-tabs">
      <scroll-view class="filter-scroll" scroll-x>
        <view class="filter-list">
          <view 
            class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
            data-filter="all"
            bindtap="onFilterChange"
          >
            全部
          </view>
          <view 
            class="filter-tab {{currentFilter === 'ongoing' ? 'active' : ''}}"
            data-filter="ongoing"
            bindtap="onFilterChange"
          >
            进行中
          </view>
          <view 
            class="filter-tab {{currentFilter === 'ended' ? 'active' : ''}}"
            data-filter="ended"
            bindtap="onFilterChange"
          >
            已结束
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- 任务列表 -->
  <scroll-view 
    class="task-list"
    scroll-y
    enable-back-to-top
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
  >
    <!-- 任务卡片 -->
    <view wx:for="{{taskList}}" wx:key="id" class="task-card status-{{item.status}}" bindtap="onTaskClick" data-task="{{item}}">
      <view class="task-content">
        <view class="task-header">
          <view class="task-title">{{item.title}}</view>
          <view class="task-status status-{{item.status}}">{{item.statusText}}</view>
        </view>
        
        <view class="task-meta">
          <text class="meta-label">创建时间：</text>
          <text class="meta-value">{{item.created_at}}</text>
        </view>
        <view class="task-meta" wx:if="{{item.course_date}}">
          <text class="meta-label">直播时间：</text>
          <text class="meta-value">{{item.course_date}}</text>
        </view>

        <!-- 简化的统计信息 -->
        <view class="task-stats">
          <view class="stat-item">
            <text class="stat-number">{{item.stats.submitted || 0}}</text>
            <text class="stat-label">已提交</text>
          </view>
          <view class="stat-divider">/</view>
          <view class="stat-item">
            <text class="stat-number">{{item.stats.reviewed || 0}}</text>
            <text class="stat-label">已批改</text>
          </view>
          <view class="stat-divider">/</view>
          <view class="stat-item">
            <text class="stat-number">{{item.stats.total_students || 0}}</text>
            <text class="stat-label">总学生</text>
          </view>
        </view>
      </view>
      
      <!-- 右箭头 -->
      <view class="task-arrow">
        <text class="arrow-icon">›</text>
      </view>
    </view>

    <!-- 加载更多 -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 没有更多 -->
    <view wx:if="{{!hasMore && taskList.length > 0}}" class="no-more">
      <text class="no-more-text">- 没有更多了 -</text>
    </view>

    <!-- 空状态 -->
    <view wx:if="{{isEmpty && !loading}}" class="empty-state">
      <image class="empty-image" src="/assets/images/empty-tasks.png" mode="aspectFit"></image>
      <text class="empty-text">{{getEmptyText()}}</text>
      <text class="empty-hint">{{getEmptyHint()}}</text>
      <button class="empty-btn" bindtap="onCreateTask" wx:if="{{currentFilter === 'all'}}">
        立即创建任务
      </button>
    </view>

    <!-- 加载中 -->
    <view wx:if="{{loading && taskList.length === 0}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>
  </scroll-view>

  <!-- 创建任务浮动按钮 -->
  <view class="fab-container">
    <view class="fab-btn" bindtap="onCreateTask">
      <text class="fab-icon">+</text>
      <text class="fab-text">新建任务</text>
    </view>
  </view>
</view>

<!-- 底部安全区域 -->
<view class="safe-bottom"></view>