<!-- åˆ›å»ºæ–°ä»»åŠ¡é¡µ -->
<view class="container">
  <!-- è¡¨å•å†…å®¹ -->
  <form bindsubmit="onSubmit" bindreset="onReset">
    <view class="form-container">
      <!-- è¯¾ç¨‹åç§° -->
      <view class="form-section">
        <view class="form-label required">
          <text class="label-text">è¯¾ç¨‹åç§°</text>
          <text class="required-star">*</text>
        </view>
        <input 
          class="form-input {{errors.title ? 'error' : ''}}"
          name="title"
          placeholder="è¯·è¾“å…¥è¯¾ç¨‹æˆ–ä»»åŠ¡çš„åç§°"
          value="{{formData.title}}"
          bindinput="onInputChange"
          data-field="title"
          maxlength="50"
        />
        <view wx:if="{{errors.title}}" class="error-text">{{errors.title}}</view>
        <view class="input-counter">{{formData.title.length}}/50</view>
      </view>

      <!-- ç›´æ’­å¼€å§‹æ—¶é—´ -->
      <view class="form-section">
        <view class="form-label required">
          <text class="label-text">ç›´æ’­å¼€å§‹æ—¶é—´</text>
          <text class="required-star">*</text>
        </view>
        <view class="datetime-picker-wrapper">
          <picker 
            mode="date" 
            value="{{formData.date}}" 
            bindchange="onDateChange"
            start="{{minDate}}"
            class="datetime-picker {{errors.date ? 'error' : ''}}"
          >
            <view class="picker-display">
              <text class="picker-text {{formData.date ? '' : 'placeholder'}}">
                {{formData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}
              </text>
              <text class="picker-icon">ğŸ“…</text>
            </view>
          </picker>
          
          <picker 
            mode="time" 
            value="{{formData.time}}" 
            bindchange="onTimeChange"
            class="datetime-picker {{errors.time ? 'error' : ''}}"
          >
            <view class="picker-display">
              <text class="picker-text {{formData.time ? '' : 'placeholder'}}">
                {{formData.time || 'è¯·é€‰æ‹©æ—¶é—´'}}
              </text>
              <text class="picker-icon">ğŸ•</text>
            </view>
          </picker>
        </view>
        <view wx:if="{{errors.date || errors.time}}" class="error-text">
          {{errors.date || errors.time}}
        </view>
        <view wx:if="{{formData.date && formData.time}}" class="datetime-preview">
          é¢„è§ˆï¼š{{formData.date}} {{formData.time}}
        </view>
      </view>

      <!-- é¢˜ç›®è¯¦æƒ… -->
      <view class="form-section">
        <view class="form-label required">
          <text class="label-text">é¢˜ç›®è¯¦æƒ…</text>
          <text class="required-star">*</text>
        </view>
        <textarea 
          class="form-textarea {{errors.requirements ? 'error' : ''}}"
          name="requirements"
          placeholder="è¯·åœ¨æ­¤å¤„è¾“å…¥è¯¦ç»†çš„é¢˜ç›®è¦æ±‚å’ŒèƒŒæ™¯ææ–™..."
          value="{{formData.requirements}}"
          bindinput="onInputChange"
          data-field="requirements"
          maxlength="2000"
          show-confirm-bar="{{false}}"
          auto-height
        />
        <view wx:if="{{errors.requirements}}" class="error-text">{{errors.requirements}}</view>
        <view class="input-counter">{{formData.requirements.length}}/2000</view>
      </view>

      <!-- ä»»åŠ¡ç±»å‹ï¼ˆé¢„ç•™ï¼‰ -->
      <view class="form-section">
        <view class="form-label">
          <text class="label-text">ä»»åŠ¡ç±»å‹</text>
        </view>
        <picker 
          range="{{taskTypes}}" 
          range-key="name"
          value="{{formData.typeIndex}}" 
          bindchange="onTypeChange"
          class="form-picker"
        >
          <view class="picker-display">
            <text class="picker-text">{{taskTypes[formData.typeIndex].name}}</text>
            <text class="picker-icon">âŒ„</text>
          </view>
        </picker>
        <view class="form-hint">V1.0ç‰ˆæœ¬ä»…æ”¯æŒç›´æ’­è¯¾ä»»åŠ¡</view>
      </view>

      <!-- é«˜çº§è®¾ç½®ï¼ˆå¯æŠ˜å ï¼‰ -->
      <view class="form-section">
        <view class="section-header" bindtap="toggleAdvanced">
          <text class="section-title">é«˜çº§è®¾ç½®</text>
          <text class="toggle-icon {{showAdvanced ? 'expanded' : ''}}">âŒ„</text>
        </view>
        
        <view wx:if="{{showAdvanced}}" class="advanced-settings">
          <!-- æ€»åˆ†è®¾ç½® -->
          <view class="setting-item">
            <view class="setting-label">æ€»åˆ†</view>
            <input 
              class="setting-input"
              type="number"
              placeholder="100"
              value="{{formData.totalScore}}"
              bindinput="onInputChange"
              data-field="totalScore"
            />
            <view class="setting-unit">åˆ†</view>
          </view>
          
          <!-- æäº¤æ¬¡æ•°é™åˆ¶ -->
          <view class="setting-item">
            <view class="setting-label">æäº¤æ¬¡æ•°é™åˆ¶</view>
            <input 
              class="setting-input"
              type="number"
              placeholder="3"
              value="{{formData.maxSubmissions}}"
              bindinput="onInputChange"
              data-field="maxSubmissions"
            />
            <view class="setting-unit">æ¬¡</view>
          </view>

          <!-- æ˜¯å¦ç«‹å³å‘å¸ƒ -->
          <view class="setting-item">
            <view class="setting-label">å‘å¸ƒçŠ¶æ€</view>
            <switch 
              checked="{{formData.publishImmediately}}" 
              bindchange="onSwitchChange"
              data-field="publishImmediately"
              color="#667eea"
            />
            <view class="setting-desc">{{formData.publishImmediately ? 'ç«‹å³å‘å¸ƒ' : 'ä¿å­˜ä¸ºè‰ç¨¿'}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’®åŒºåŸŸ -->
    <view class="submit-area">
      <button 
        class="btn-secondary" 
        bindtap="saveDraft"
        disabled="{{isSubmitting}}"
      >
        {{isSubmitting && submitMode === 'draft' ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜è‰ç¨¿'}}
      </button>
      <button 
        class="btn-primary" 
        form-type="submit"
        disabled="{{!canSubmit || isSubmitting}}"
      >
        {{isSubmitting && submitMode === 'publish' ? 'å‘å¸ƒä¸­...' : (isEditMode ? 'æ›´æ–°ä»»åŠ¡' : 'å‘å¸ƒä»»åŠ¡')}}
      </button>
    </view>
  </form>
</view>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-bottom"></view>