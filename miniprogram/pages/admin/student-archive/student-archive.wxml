<!-- ä¸ªäººå­¦ä¹ æ¡£æ¡ˆé¡µ -->
<view class="container">
  <!-- å­¦ç”Ÿä¿¡æ¯å¤´ -->
  <view class="student-header">
    <view class="avatar-wrapper">
      <image class="student-avatar" src="{{studentInfo.avatar_url}}" mode="aspectFill" wx:if="{{studentInfo.avatar_url}}" lazy-load="true" binderror="onImageError"></image>
      <view class="avatar-placeholder" wx:else>
        <text class="avatar-icon">ğŸ‘¤</text>
      </view>
    </view>
    <view class="student-info">
      <view class="student-name">{{studentInfo.nickname || 'æœªè®¾ç½®æ˜µç§°'}}</view>
      <view class="student-stats">
        <view class="stat-item">
          <text class="stat-number">{{studentInfo.total_submissions || 0}}</text>
          <text class="stat-label">æ€»æäº¤</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{studentInfo.completed_tasks || 0}}</text>
          <text class="stat-label">å·²å®Œæˆ</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{studentInfo.average_score || 0}}åˆ†</text>
          <text class="stat-label">å¹³å‡åˆ†</text>
        </view>
      </view>
      <view class="permission-info">
        <text class="permission-type {{studentInfo.permission_type}}">
          {{studentInfo.permission_type === 'paid' ? 'ä»˜è´¹å­¦å‘˜' : 'è¯•ç”¨å­¦å‘˜'}}
        </text>
        <text class="permission-expire" wx:if="{{studentInfo.permission_expire}}">
          åˆ°æœŸï¼š{{studentInfo.permission_expire}}
        </text>
      </view>
    </view>
  </view>

  <!-- å†å²ä½œä¸šåˆ—è¡¨ -->
  <view class="archive-section">
    <view class="section-title">
      <text class="title-text">å­¦ä¹ æ¡£æ¡ˆ</text>
      <text class="archive-count">å…±{{archiveList.length}}æ¡è®°å½•</text>
    </view>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- å†å²ä½œä¸šåˆ—è¡¨ -->
    <view class="archive-list" wx:else>
      <view 
        class="task-card" 
        wx:for="{{archiveList}}" 
        wx:key="id"
        bindtap="onTaskClick"
        data-task="{{item}}"
      >
        <!-- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ -->
        <view class="task-header">
          <view class="task-info">
            <view class="task-title">{{item.title}}</view>
            <view class="task-meta">
              <text class="course-type {{item.course_type}}">
                {{item.course_type === 'essay' ? 'ç”³è®º' : 'é¢è¯•'}}
              </text>
              <text class="task-date">{{item.submit_date}}</text>
            </view>
          </view>
          <view class="task-status">
            <view class="status-badge {{item.status}}">
              {{item.status === 'graded' ? 'å·²æ‰¹æ”¹' : (item.status === 'submitted' ? 'å·²æäº¤' : 'æœªå®Œæˆ')}}
            </view>
          </view>
        </view>

        <!-- è¯„ä»·ç»“æœ -->
        <view class="task-result" wx:if="{{item.status === 'graded'}}">
          <view class="score-section">
            <text class="score-label">è¯„ä»·ï¼š</text>
            <text class="score-value {{item.evaluation}}">{{item.evaluation || 'æš‚æ— è¯„ä»·'}}</text>
          </view>
          <view class="comment-preview" wx:if="{{item.teacher_comment}}">
            <text class="comment-text">{{item.teacher_comment}}</text>
          </view>
        </view>

        <!-- æäº¤å†…å®¹é¢„è§ˆ -->
        <view class="submission-preview" wx:if="{{item.submission_images && item.submission_images.length > 0}}">
          <view class="preview-images">
            <image 
              class="preview-image" 
              src="{{image}}" 
              mode="aspectFill"
              wx:for="{{item.submission_images}}" 
              wx:for-item="image"
              wx:key="*this"
              bindtap="onImagePreview"
              data-url="{{image}}"
              data-urls="{{item.submission_images}}"
              lazy-load="true"
              show-menu-by-longpress="false"
              binderror="onImageError"
            ></image>
            <view class="image-count" wx:if="{{item.submission_images.length > 3}}">
              +{{item.submission_images.length - 3}}
            </view>
          </view>
        </view>

        <!-- æ“ä½œç®­å¤´ -->
        <view class="task-arrow">
          <text class="arrow-icon">â€º</text>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="loading-more" wx:if="{{loadingMore}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½æ›´å¤š...</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view class="no-more" wx:elif="{{!hasMore && archiveList.length > 0}}">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šè®°å½•äº†</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <empty-state
      show="{{!loading && isEmpty}}"
      icon="ğŸ“š"
      title="è¯¥å­¦ç”Ÿæš‚æ— ä½œä¸šè®°å½•"
      description="ç­‰å¾…å­¦ç”Ÿæäº¤ä½œä¸šåï¼Œå­¦ä¹ æ¡£æ¡ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º"
      show-action="{{true}}"
      action-text="è¿”å›å­¦ç”Ÿåˆ—è¡¨"
      action-type="outline"
      bind:actionClick="onBackToStudents"
    ></empty-state>
  </view>

  <!-- æµ®åŠ¨æ“ä½œ -->
  <view class="fab-actions" wx:if="{{!isEmpty}}">
    <view class="fab-btn" bindtap="onExportArchive">
      <text class="fab-icon">ğŸ“„</text>
      <text class="fab-text">å¯¼å‡ºæ¡£æ¡ˆ</text>
    </view>
  </view>
</view>