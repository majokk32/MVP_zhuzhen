<!-- 个人学习档案页 -->
<view class="container">
  <!-- 学生信息头 -->
  <view class="student-header">
    <view class="avatar-wrapper">
      <image class="student-avatar" src="{{studentInfo.avatar_url}}" mode="aspectFill" wx:if="{{studentInfo.avatar_url}}" lazy-load="true" binderror="onImageError"></image>
      <view class="avatar-placeholder" wx:else>
        <text class="avatar-icon">👤</text>
      </view>
    </view>
    <view class="student-info">
      <view class="student-name">{{studentInfo.nickname || '未设置昵称'}}</view>
      <view class="student-stats">
        <view class="stat-item">
          <text class="stat-number">{{studentInfo.total_submissions || 0}}</text>
          <text class="stat-label">总提交</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{studentInfo.completed_tasks || 0}}</text>
          <text class="stat-label">已完成</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{studentInfo.average_score || 0}}分</text>
          <text class="stat-label">平均分</text>
        </view>
      </view>
      <view class="permission-info">
        <text class="permission-type {{studentInfo.permission_type}}">
          {{studentInfo.permission_type === 'paid' ? '付费学员' : '试用学员'}}
        </text>
        <text class="permission-expire" wx:if="{{studentInfo.permission_expire}}">
          到期：{{studentInfo.permission_expire}}
        </text>
      </view>
    </view>
  </view>

  <!-- 历史作业列表 -->
  <view class="archive-section">
    <view class="section-title">
      <text class="title-text">学习档案</text>
      <text class="archive-count">共{{archiveList.length}}条记录</text>
    </view>
    
    <!-- 加载状态 -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 历史作业列表 -->
    <view class="archive-list" wx:else>
      <view 
        class="task-card" 
        wx:for="{{archiveList}}" 
        wx:key="id"
        bindtap="onTaskClick"
        data-task="{{item}}"
      >
        <!-- 任务基本信息 -->
        <view class="task-header">
          <view class="task-info">
            <view class="task-title">{{item.title}}</view>
            <view class="task-meta">
              <text class="course-type {{item.course_type}}">
                {{item.course_type === 'essay' ? '申论' : '面试'}}
              </text>
              <text class="task-date">{{item.submit_date}}</text>
            </view>
          </view>
          <view class="task-status">
            <view class="status-badge {{item.status}}">
              {{item.status === 'graded' ? '已批改' : (item.status === 'submitted' ? '已提交' : '未完成')}}
            </view>
          </view>
        </view>

        <!-- 评价结果 -->
        <view class="task-result" wx:if="{{item.status === 'graded'}}">
          <view class="score-section">
            <text class="score-label">评价：</text>
            <text class="score-value {{item.evaluation}}">{{item.evaluation || '暂无评价'}}</text>
          </view>
          <view class="comment-preview" wx:if="{{item.teacher_comment}}">
            <text class="comment-text">{{item.teacher_comment}}</text>
          </view>
        </view>

        <!-- 提交内容预览 -->
        <view class="submission-preview" wx:if="{{item.submission_images && item.submission_images.length > 0}}">
          <view class="preview-images">
            <image 
              class="preview-image" 
              src="{{image}}" 
              mode="aspectFill"
              wx:for="{{item.submission_images}}" 
              wx:for-item="image"
              wx:key="*this"
              bindtap="onImagePreview"
              data-url="{{image}}"
              data-urls="{{item.submission_images}}"
              lazy-load="true"
              show-menu-by-longpress="false"
              binderror="onImageError"
            ></image>
            <view class="image-count" wx:if="{{item.submission_images.length > 3}}">
              +{{item.submission_images.length - 3}}
            </view>
          </view>
        </view>

        <!-- 操作箭头 -->
        <view class="task-arrow">
          <text class="arrow-icon">›</text>
        </view>
      </view>

      <!-- 加载更多 -->
      <view class="loading-more" wx:if="{{loadingMore}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">加载更多...</text>
      </view>

      <!-- 没有更多 -->
      <view class="no-more" wx:elif="{{!hasMore && archiveList.length > 0}}">
        <text class="no-more-text">没有更多记录了</text>
      </view>
    </view>

    <!-- 空状态 -->
    <empty-state
      show="{{!loading && isEmpty}}"
      icon="📚"
      title="该学生暂无作业记录"
      description="等待学生提交作业后，学习档案将在这里显示"
      show-action="{{true}}"
      action-text="返回学生列表"
      action-type="outline"
      bind:actionClick="onBackToStudents"
    ></empty-state>
  </view>

  <!-- 浮动操作 -->
  <view class="fab-actions" wx:if="{{!isEmpty}}">
    <view class="fab-btn" bindtap="onExportArchive">
      <text class="fab-icon">📄</text>
      <text class="fab-text">导出档案</text>
    </view>
  </view>
</view>