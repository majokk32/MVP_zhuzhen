<!-- 个人中心页 -->
<view class="container">
  <!-- 加载状态 -->
  <skeleton show="{{loading}}" type="profile" />
  
  <!-- 用户信息展示区 -->
  <view class="user-profile-section" wx:if="{{!loading}}">
    <!-- 用户头像和昵称 -->
    <view class="user-main-info">
      <image class="user-avatar" src="{{userInfo.avatar}}" mode="aspectFill" wx:if="{{userInfo.avatar}}" lazy-load="true" binderror="onImageError"/>
      <view class="avatar-placeholder" wx:else>
        <text class="avatar-icon">👤</text>
      </view>
      
      <!-- 昵称和编辑按钮 -->
      <view class="nickname-section">
        <text class="user-nickname">{{userInfo.nickname || '用户'}}</text>
        <button class="edit-nickname-btn" bindtap="editNickname">
          <text class="edit-icon">✏️</text>
        </button>
      </view>
    </view>

  </view>

  <!-- V1.0 学习数据可视化区 -->
  <view class="learning-data-section" wx:if="{{!loading}}">
    <!-- 核心数据大卡片 -->
    <view class="core-stats-card">
      <view class="main-stat">
        <text class="stat-number">{{learningData.current_streak || 0}}</text>
        <text class="stat-label">连续学习天数 🔥</text>
      </view>
      <view class="side-stats">
        <view class="side-stat">
          <text class="side-number">{{learningData.total_score || 0}}</text>
          <text class="side-label">总积分</text>
        </view>
        <view class="side-stat">
          <text class="side-number">{{learningData.week_checkins || 0}}</text>
          <text class="side-label">本周打卡</text>
        </view>
      </view>
    </view>

    <!-- 14天打卡图 -->
    <view class="checkin-chart-section">
      <view class="section-header">
        <text class="section-title">学习活跃度</text>
        <text class="section-desc">近14天打卡记录</text>
      </view>
      <checkin-chart checkin-data="{{checkinChartData}}" />
    </view>

    <!-- 数据指标卡片组 -->
    <view class="data-cards-section">
      <view class="data-card">
        <text class="card-number">{{learningData.total_submissions || 0}}</text>
        <text class="card-label">累计提交</text>
      </view>
      <view class="data-card">
        <text class="card-number">{{learningData.best_streak || 0}}</text>
        <text class="card-label">历史最佳</text>
      </view>
      <view class="data-card" bindtap="goToLeaderboard">
        <text class="card-number">{{userRank || '--'}}</text>
        <text class="card-label">月度排名</text>
      </view>
    </view>
  </view>
  
  <!-- 内容列表区 -->
  <view class="content-list">
    <!-- 我的作业统计 -->
    <view class="list-item" bindtap="goToMySubmissions">
      <view class="item-content">
        <text class="item-title">我的作业统计</text>
        <text class="item-desc">累计提交 {{stats.totalSubmissions || 0}} 次</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
    
    <!-- 权限状态和有效期 -->
    <view class="list-item permission-status">
      <view class="item-content">
        <text class="item-title">权限状态</text>
        <text class="item-desc {{getPermissionStatusClass(permissionStatus)}}">{{permissionStatus}}</text>
      </view>
    </view>
    
    <!-- 学习复盘 -->
    <view class="list-item" bindtap="goToReview">
      <view class="item-content">
        <text class="item-title">学习复盘</text>
        <text class="item-desc">定期回顾，持续进步</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
    
    <!-- 课后加餐 -->
    <view class="list-item" bindtap="goToMaterials">
      <view class="item-content">
        <text class="item-title">课后加餐</text>
        <text class="item-desc">优质资料，巩固提升</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
    
    <!-- 通知设置 -->
    <view class="list-item" bindtap="openNotificationSettings">
      <view class="item-content">
        <text class="item-title">通知设置</text>
        <text class="item-desc">管理推送通知偏好</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
    
    <!-- 设置选项（预留） -->
    <view class="list-item" bindtap="goToSettings">
      <view class="item-content">
        <text class="item-title">其他设置</text>
        <text class="item-desc">隐私、缓存等</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
    
    <!-- 关于我们（预留） -->
    <view class="list-item" bindtap="goToAbout">
      <view class="item-content">
        <text class="item-title">关于我们</text>
        <text class="item-desc">v1.0</text>
      </view>
      <text class="item-arrow">›</text>
    </view>
  </view>
  
  <!-- 退出登录 -->
  <view class="logout-section">
    <button class="logout-btn" bindtap="handleLogout">退出登录</button>
  </view>

</view>

<!-- 通知设置面板 -->
<notification-settings 
  show="{{showNotificationSettings}}" 
  bind:close="closeNotificationSettings"
/>

<!-- 底部安全区域 -->
<view class="safe-bottom"></view>