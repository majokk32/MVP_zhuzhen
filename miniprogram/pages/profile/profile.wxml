<!-- ä¸ªäººä¸­å¿ƒé¡µ -->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <skeleton show="{{loading}}" type="profile" />
  
  <!-- ç”¨æˆ·ä¿¡æ¯å±•ç¤ºåŒº -->
  <view class="user-profile-section" wx:if="{{!loading}}">
    <!-- ç”¨æˆ·å¤´åƒå’Œæ˜µç§° -->
    <view class="user-main-info">
      <image class="user-avatar" src="{{userInfo.avatar}}" mode="aspectFill" wx:if="{{userInfo.avatar}}" lazy-load="true" binderror="onImageError"/>
      <view class="avatar-placeholder" wx:else>
        <text class="avatar-icon">ğŸ‘¤</text>
      </view>
      
      <!-- æ˜µç§°å’Œç¼–è¾‘æŒ‰é’® -->
      <view class="nickname-section">
        <text class="user-nickname">{{userInfo.nickname || 'ç”¨æˆ·'}}</text>
        <button class="edit-nickname-btn" bindtap="editNickname">
          <text class="edit-icon">âœï¸</text>
        </button>
      </view>
    </view>

  </view>

  <!-- V1.0 å­¦ä¹ æ•°æ®å¯è§†åŒ–åŒº -->
  <view class="learning-data-section" wx:if="{{!loading}}">
    <!-- æ ¸å¿ƒæ•°æ®å¤§å¡ç‰‡ -->
    <view class="core-stats-card">
      <view class="main-stat">
        <text class="stat-number">{{learningData.current_streak || 0}}</text>
        <text class="stat-label">è¿ç»­å­¦ä¹ å¤©æ•° ğŸ”¥</text>
      </view>
      <view class="side-stats">
        <view class="side-stat">
          <text class="side-number">{{learningData.total_score || 0}}</text>
          <text class="side-label">æ€»ç§¯åˆ†</text>
        </view>
        <view class="side-stat">
          <text class="side-number">{{learningData.week_checkins || 0}}</text>
          <text class="side-label">æœ¬å‘¨æ‰“å¡</text>
        </view>
      </view>
    </view>

    <!-- 14å¤©æ‰“å¡å›¾ -->
    <view class="checkin-chart-section">
      <view class="section-header">
        <text class="section-title">å­¦ä¹ æ´»è·ƒåº¦</text>
        <text class="section-desc">è¿‘14å¤©æ‰“å¡è®°å½•</text>
      </view>
      <checkin-chart checkin-data="{{checkinChartData}}" />
    </view>

    <!-- æ•°æ®æŒ‡æ ‡å¡ç‰‡ç»„ -->
    <view class="data-cards-section">
      <view class="data-card">
        <text class="card-number">{{learningData.total_submissions || 0}}</text>
        <text class="card-label">ç´¯è®¡æäº¤</text>
      </view>
      <view class="data-card">
        <text class="card-number">{{learningData.best_streak || 0}}</text>
        <text class="card-label">å†å²æœ€ä½³</text>
      </view>
      <view class="data-card" bindtap="goToLeaderboard">
        <text class="card-number">{{userRank || '--'}}</text>
        <text class="card-label">æœˆåº¦æ’å</text>
      </view>
    </view>
  </view>
  
  <!-- å†…å®¹åˆ—è¡¨åŒº -->
  <view class="content-list">
    <!-- æˆ‘çš„ä½œä¸šç»Ÿè®¡ -->
    <view class="list-item" bindtap="goToMySubmissions">
      <view class="item-content">
        <text class="item-title">æˆ‘çš„ä½œä¸šç»Ÿè®¡</text>
        <text class="item-desc">ç´¯è®¡æäº¤ {{stats.totalSubmissions || 0}} æ¬¡</text>
      </view>
      <text class="item-arrow">â€º</text>
    </view>
    
    <!-- æƒé™çŠ¶æ€å’Œæœ‰æ•ˆæœŸ -->
    <view class="list-item permission-status">
      <view class="item-content">
        <text class="item-title">æƒé™çŠ¶æ€</text>
        <text class="item-desc {{getPermissionStatusClass(permissionStatus)}}">{{permissionStatus}}</text>
      </view>
    </view>
    
    <!-- å­¦ä¹ å¤ç›˜ -->
    <view class="list-item" bindtap="goToReview">
      <view class="item-content">
        <text class="item-title">å­¦ä¹ å¤ç›˜</text>
        <text class="item-desc">å®šæœŸå›é¡¾ï¼ŒæŒç»­è¿›æ­¥</text>
      </view>
      <text class="item-arrow">â€º</text>
    </view>
    
    <!-- è¯¾ååŠ é¤ -->
    <view class="list-item" bindtap="goToMaterials">
      <view class="item-content">
        <text class="item-title">è¯¾ååŠ é¤</text>
        <text class="item-desc">ä¼˜è´¨èµ„æ–™ï¼Œå·©å›ºæå‡</text>
      </view>
      <text class="item-arrow">â€º</text>
    </view>
    
    <!-- é€šçŸ¥è®¾ç½® -->
    <view class="list-item" bindtap="openNotificationSettings">
      <view class="item-content">
        <text class="item-title">é€šçŸ¥è®¾ç½®</text>
        <text class="item-desc">ç®¡ç†æ¨é€é€šçŸ¥åå¥½</text>
      </view>
      <text class="item-arrow">â€º</text>
    </view>
    
    <!-- è®¾ç½®é€‰é¡¹ï¼ˆé¢„ç•™ï¼‰ -->
    <view class="list-item" bindtap="goToSettings">
      <view class="item-content">
        <text class="item-title">å…¶ä»–è®¾ç½®</text>
        <text class="item-desc">éšç§ã€ç¼“å­˜ç­‰</text>
      </view>
      <text class="item-arrow">â€º</text>
    </view>
    
    <!-- å…³äºæˆ‘ä»¬ï¼ˆé¢„ç•™ï¼‰ -->
    <view class="list-item" bindtap="goToAbout">
      <view class="item-content">
        <text class="item-title">å…³äºæˆ‘ä»¬</text>
        <text class="item-desc">v1.0</text>
      </view>
      <text class="item-arrow">â€º</text>
    </view>
  </view>
  
  <!-- é€€å‡ºç™»å½• -->
  <view class="logout-section">
    <button class="logout-btn" bindtap="handleLogout">é€€å‡ºç™»å½•</button>
  </view>

</view>

<!-- é€šçŸ¥è®¾ç½®é¢æ¿ -->
<notification-settings 
  show="{{showNotificationSettings}}" 
  bind:close="closeNotificationSettings"
/>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-bottom"></view>