<!--å¤ç›˜ä»»åŠ¡è¯¦æƒ…é¡µé¢ - ç®€åŒ–ç‰ˆæœ¬-->
<view class="container">
  <!-- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ -->
  <view class="task-header">
    <view class="task-basic-info">
      <text class="task-title">{{taskDetail.title}}</text>
      <view class="task-meta">
        <text class="task-subject">{{taskDetail.subject}}</text>
        <text class="review-count">ç¬¬{{taskDetail.review_count}}æ¬¡å¤ç›˜</text>
        <text class="task-status">{{statusMap[taskDetail.status]}}</text>
      </view>
      <text class="original-date">åŸå­¦ä¹ æ—¶é—´ï¼š{{taskDetail.original_date}}</text>
    </view>
  </view>

  <!-- å¤ç›˜è¿›åº¦ -->
  <view class="progress-section">
    <view class="section-title">
      <text>å¤ç›˜è¿›åº¦</text>
    </view>
    <view class="progress-info">
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{(taskDetail.review_count / 5) * 100}}%"></view>
      </view>
      <text class="progress-text">{{taskDetail.review_count}}/5 æ¬¡å¤ç›˜</text>
    </view>
    
    <!-- å¤ç›˜æ—¶é—´çº¿ -->
    <view class="timeline">
      <view 
        class="timeline-item {{index < taskDetail.review_count ? 'completed' : 'pending'}}"
        wx:for="{{reviewSchedule}}"
        wx:key="day"
      >
        <view class="timeline-dot"></view>
        <view class="timeline-content">
          <text class="timeline-day">ç¬¬{{item.day}}å¤©</text>
          <text class="timeline-date">{{item.date}}</text>
          <text class="timeline-status" wx:if="{{index < taskDetail.review_count}}">å·²å®Œæˆ</text>
          <text class="timeline-status current" wx:elif="{{index === taskDetail.review_count}}">ä»Šæ—¥å¤ç›˜</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŸå§‹ä½œä¸šå†…å®¹ -->
  <view class="content-section">
    <view class="section-title">
      <text>åŸå§‹ä½œä¸šå†…å®¹</text>
    </view>
    <view class="content-card">
      <text class="content-text">{{taskDetail.original_content}}</text>
      
      <!-- å¦‚æœæœ‰å›¾ç‰‡ -->
      <view class="content-images" wx:if="{{taskDetail.images && taskDetail.images.length > 0}}">
        <image 
          class="content-image"
          wx:for="{{taskDetail.images}}"
          wx:key="*this"
          src="{{item}}"
          mode="aspectFit"
          bindtap="previewImage"
          data-url="{{item}}"
        />
      </view>
    </view>
  </view>

  <!-- å†å²è¯„ä»· -->
  <view class="feedback-section" wx:if="{{taskDetail.feedback}}">
    <view class="section-title">
      <text>è€å¸ˆè¯„ä»·</text>
    </view>
    <view class="feedback-card">
      <view class="feedback-score">
        <text class="score-label">è¯„åˆ†ï¼š</text>
        <text class="score-value">{{taskDetail.feedback.score}}</text>
      </view>
      <text class="feedback-text">{{taskDetail.feedback.comment}}</text>
    </view>
  </view>

  <!-- å¤ç›˜ç¬”è®° -->
  <view class="notes-section">
    <view class="section-title">
      <text>å¤ç›˜ç¬”è®°</text>
      <text class="edit-notes" bindtap="editNotes">{{hasNotes ? 'ç¼–è¾‘' : 'æ·»åŠ '}}</text>
    </view>
    
    <view class="notes-content" wx:if="{{hasNotes}}">
      <text class="notes-text">{{taskDetail.review_notes}}</text>
    </view>
    
    <view class="no-notes" wx:else>
      <text class="no-notes-text">è¿˜æ²¡æœ‰å¤ç›˜ç¬”è®°</text>
      <text class="add-notes-hint">ç‚¹å‡»"æ·»åŠ "è®°å½•ä½ çš„å¤ç›˜å¿ƒå¾—</text>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button 
      class="action-btn complete"
      bindtap="completeReview"
      wx:if="{{taskDetail.status === 'pending'}}"
    >
      å®Œæˆå¤ç›˜
    </button>
    
    <button 
      class="action-btn skip"
      bindtap="skipReview"
      wx:if="{{taskDetail.status === 'pending'}}"
    >
      è·³è¿‡è¿™æ¬¡
    </button>
    
    <view class="completed-info" wx:if="{{taskDetail.status === 'completed'}}">
      <text class="completed-text">âœ“ æœ¬æ¬¡å¤ç›˜å·²å®Œæˆ</text>
      <text class="next-review" wx:if="{{taskDetail.review_count < 5}}">
        ä¸‹æ¬¡å¤ç›˜ï¼š{{nextReviewDate}}
      </text>
      <text class="mastered-text" wx:else>
        ğŸ‰ å·²å®Œå…¨æŒæ¡ï¼
      </text>
    </view>
  </view>
</view>

<!-- ç¬”è®°ç¼–è¾‘å¼¹çª— -->
<view class="notes-modal" wx:if="{{showNotesModal}}" bindtap="closeNotesModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">å¤ç›˜ç¬”è®°</text>
      <text class="modal-close" bindtap="closeNotesModal">Ã—</text>
    </view>
    
    <view class="modal-body">
      <textarea
        class="notes-textarea"
        placeholder="è®°å½•ä½ åœ¨å¤ç›˜è¿‡ç¨‹ä¸­çš„å¿ƒå¾—ä½“ä¼š..."
        value="{{tempNotes}}"
        bindinput="onNotesInput"
        maxlength="500"
        auto-height
      />
      <text class="char-count">{{tempNotes.length}}/500</text>
    </view>
    
    <view class="modal-footer">
      <button class="modal-btn secondary" bindtap="closeNotesModal">
        å–æ¶ˆ
      </button>
      <button class="modal-btn primary" bindtap="saveNotes">
        ä¿å­˜
      </button>
    </view>
  </view>
</view>