<!--å¤ç›˜è¯¦æƒ…é¡µé¢-->
<view class="container">
  <!-- å¤ç›˜æ ‡é¢˜å’Œæ—¶é—´ -->
  <view class="review-header">
    <view class="review-title">
      <text class="title-text">å­¦ä¹ å¤ç›˜æŠ¥å‘Š</text>
      <text class="period-text">{{reviewData.period_start}} è‡³ {{reviewData.period_end}}</text>
    </view>
    
    <view class="review-status">
      <text class="status-badge {{reviewData.status}}">
        {{statusMap[reviewData.status] || 'æœªçŸ¥'}}
      </text>
    </view>
  </view>

  <!-- æˆç»©ç»Ÿè®¡ -->
  <view class="section-card" wx:if="{{reviewData.score_summary}}">
    <view class="section-header">
      <text class="section-title">ğŸ“Š æˆç»©ç»Ÿè®¡</text>
    </view>
    
    <view class="score-overview">
      <view class="score-item">
        <text class="score-number">{{reviewData.score_summary.total_submissions || 0}}</text>
        <text class="score-label">æäº¤æ¬¡æ•°</text>
      </view>
      
      <view class="score-item">
        <text class="score-number">{{reviewData.score_summary.average_score || 0}}</text>
        <text class="score-label">å¹³å‡åˆ†</text>
      </view>
      
      <view class="score-item">
        <text class="score-number">{{reviewData.score_summary.total_points || 0}}</text>
        <text class="score-label">è·å¾—ç§¯åˆ†</text>
      </view>
      
      <view class="score-item">
        <text class="score-number">{{reviewData.score_summary.excellent_rate || 0}}%</text>
        <text class="score-label">æä½³ç‡</text>
      </view>
    </view>
    
    <view class="grade-distribution" wx:if="{{reviewData.score_summary.grade_distribution}}">
      <text class="subsection-title">è¯„ä»·åˆ†å¸ƒ</text>
      <view class="grade-bars">
        <view 
          class="grade-bar" 
          wx:for="{{gradeList}}" 
          wx:key="grade"
        >
          <text class="grade-name">{{item.grade}}</text>
          <view class="grade-bar-bg">
            <view 
              class="grade-bar-fill {{item.class}}"
              style="width: {{item.percentage}}%"
            ></view>
          </view>
          <text class="grade-count">{{item.count}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é”™é¢˜å›é¡¾ -->
  <view class="section-card" wx:if="{{reviewData.mistake_analysis}}">
    <view class="section-header">
      <text class="section-title">âŒ é”™é¢˜å›é¡¾</text>
    </view>
    
    <view class="mistake-summary">
      <view class="mistake-stat">
        <text class="stat-label">å¾…å¤ç›˜é¢˜ç›®</text>
        <text class="stat-value">{{reviewData.mistake_analysis.pending_review_count || 0}}é“</text>
      </view>
      
      <view class="mistake-stat">
        <text class="stat-label">ä½åˆ†ä½œä¸š</text>
        <text class="stat-value">{{reviewData.mistake_analysis.low_score_count || 0}}ä»½</text>
      </view>
    </view>
    
    <view class="mistake-tasks" wx:if="{{reviewData.mistake_analysis.pending_tasks.length > 0}}">
      <text class="subsection-title">éœ€è¦å¤ç›˜çš„ä»»åŠ¡</text>
      <view class="task-list">
        <view 
          class="task-item"
          wx:for="{{reviewData.mistake_analysis.pending_tasks}}"
          wx:key="submission_id"
          bindtap="goToTask"
          data-id="{{item.submission_id}}"
        >
          <view class="task-info">
            <text class="task-title">{{item.task_title}}</text>
            <text class="task-date">æäº¤æ—¶é—´ï¼š{{item.submit_date}}</text>
          </view>
          <text class="task-arrow">></text>
        </view>
      </view>
    </view>
    
    <view class="improvement-suggestions" wx:if="{{reviewData.mistake_analysis.improvement_suggestions.length > 0}}">
      <text class="subsection-title">æ”¹è¿›å»ºè®®</text>
      <view class="suggestions-list">
        <text 
          class="suggestion-item"
          wx:for="{{reviewData.mistake_analysis.improvement_suggestions}}"
          wx:key="*this"
        >
          â€¢ {{item}}
        </text>
      </view>
    </view>
  </view>

  <!-- å­¦ä¹ è¿›åº¦ -->
  <view class="section-card" wx:if="{{reviewData.progress_data}}">
    <view class="section-header">
      <text class="section-title">ğŸ“ˆ å­¦ä¹ è¿›åº¦</text>
    </view>
    
    <view class="progress-overview">
      <view class="progress-item">
        <text class="progress-number">{{reviewData.progress_data.active_days || 0}}</text>
        <text class="progress-label">æ´»è·ƒå¤©æ•°</text>
      </view>
      
      <view class="progress-item">
        <text class="progress-number">{{reviewData.progress_data.activity_rate || 0}}%</text>
        <text class="progress-label">æ´»è·ƒç‡</text>
      </view>
      
      <view class="progress-item">
        <text class="progress-number">{{reviewData.progress_data.current_streak || 0}}</text>
        <text class="progress-label">è¿ç»­å¤©æ•°</text>
      </view>
      
      <view class="progress-item">
        <text class="progress-number">{{reviewData.progress_data.best_streak || 0}}</text>
        <text class="progress-label">æœ€ä½³è®°å½•</text>
      </view>
    </view>
    
    <view class="activity-breakdown" wx:if="{{activityList.length > 0}}">
      <text class="subsection-title">æ´»åŠ¨åˆ†å¸ƒ</text>
      <view class="activity-list">
        <view 
          class="activity-item"
          wx:for="{{activityList}}"
          wx:key="type"
        >
          <text class="activity-icon">{{item.icon}}</text>
          <text class="activity-name">{{item.name}}</text>
          <text class="activity-count">{{item.count}}æ¬¡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- AIå­¦ä¹ å»ºè®® -->
  <view class="section-card" wx:if="{{reviewData.ai_suggestions}}">
    <view class="section-header">
      <text class="section-title">ğŸ¤– å­¦ä¹ å»ºè®®</text>
    </view>
    
    <view class="ai-suggestions">
      <text class="suggestions-text">{{reviewData.ai_suggestions}}</text>
    </view>
  </view>

  <!-- ä¸ªäººç¬”è®° -->
  <view class="section-card">
    <view class="section-header">
      <text class="section-title">ğŸ“ å¤ç›˜ç¬”è®°</text>
    </view>
    
    <textarea 
      class="notes-input"
      placeholder="è®°å½•ä½ çš„å­¦ä¹ å¿ƒå¾—å’Œåæ€..."
      value="{{userNotes}}"
      bindinput="onNotesInput"
      maxlength="2000"
      auto-height
    ></textarea>
    
    <view class="notes-count">
      <text>{{userNotes.length}}/2000</text>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="actions" wx:if="{{reviewData.status === 'pending'}}">
    <button class="action-btn secondary" bindtap="skipReview">
      è·³è¿‡å¤ç›˜
    </button>
    <button class="action-btn primary" bindtap="completeReview">
      å®Œæˆå¤ç›˜
    </button>
  </view>
  
  <!-- å·²å®ŒæˆçŠ¶æ€ -->
  <view class="completed-info" wx:if="{{reviewData.status === 'completed'}}">
    <view class="completed-badge">
      <text>âœ… å¤ç›˜å·²å®Œæˆ</text>
    </view>
    <view class="completion-info">
      <text>å®Œæˆæ—¶é—´ï¼š{{reviewData.completed_at}}</text>
      <text wx:if="{{reviewData.completion_duration}}">
        è€—æ—¶ï¼š{{reviewData.completion_duration}}åˆ†é’Ÿ
      </text>
    </view>
  </view>
</view>