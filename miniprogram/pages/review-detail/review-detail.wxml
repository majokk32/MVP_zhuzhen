<!--复盘任务详情页面 - 简化版本-->
<view class="container">
  <!-- 任务基本信息 -->
  <view class="task-header">
    <view class="task-basic-info">
      <text class="task-title">{{taskDetail.title}}</text>
      <view class="task-meta">
        <text class="task-subject">{{taskDetail.subject}}</text>
        <text class="review-count">第{{taskDetail.review_count}}次复盘</text>
        <text class="task-status">{{statusMap[taskDetail.status]}}</text>
      </view>
      <text class="original-date">原学习时间：{{taskDetail.original_date}}</text>
    </view>
  </view>

  <!-- 复盘进度 -->
  <view class="progress-section">
    <view class="section-title">
      <text>复盘进度</text>
    </view>
    <view class="progress-info">
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{(taskDetail.review_count / 5) * 100}}%"></view>
      </view>
      <text class="progress-text">{{taskDetail.review_count}}/5 次复盘</text>
    </view>
    
    <!-- 复盘时间线 -->
    <view class="timeline">
      <view 
        class="timeline-item {{index < taskDetail.review_count ? 'completed' : 'pending'}}"
        wx:for="{{reviewSchedule}}"
        wx:key="day"
      >
        <view class="timeline-dot"></view>
        <view class="timeline-content">
          <text class="timeline-day">第{{item.day}}天</text>
          <text class="timeline-date">{{item.date}}</text>
          <text class="timeline-status" wx:if="{{index < taskDetail.review_count}}">已完成</text>
          <text class="timeline-status current" wx:elif="{{index === taskDetail.review_count}}">今日复盘</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 原始作业内容 -->
  <view class="content-section">
    <view class="section-title">
      <text>原始作业内容</text>
    </view>
    <view class="content-card">
      <text class="content-text">{{taskDetail.original_content}}</text>
      
      <!-- 如果有图片 -->
      <view class="content-images" wx:if="{{taskDetail.images && taskDetail.images.length > 0}}">
        <image 
          class="content-image"
          wx:for="{{taskDetail.images}}"
          wx:key="*this"
          src="{{item}}"
          mode="aspectFit"
          bindtap="previewImage"
          data-url="{{item}}"
        />
      </view>
    </view>
  </view>

  <!-- 历史评价 -->
  <view class="feedback-section" wx:if="{{taskDetail.feedback}}">
    <view class="section-title">
      <text>老师评价</text>
    </view>
    <view class="feedback-card">
      <view class="feedback-score">
        <text class="score-label">评分：</text>
        <text class="score-value">{{taskDetail.feedback.score}}</text>
      </view>
      <text class="feedback-text">{{taskDetail.feedback.comment}}</text>
    </view>
  </view>

  <!-- 复盘笔记 -->
  <view class="notes-section">
    <view class="section-title">
      <text>复盘笔记</text>
      <text class="edit-notes" bindtap="editNotes">{{hasNotes ? '编辑' : '添加'}}</text>
    </view>
    
    <view class="notes-content" wx:if="{{hasNotes}}">
      <text class="notes-text">{{taskDetail.review_notes}}</text>
    </view>
    
    <view class="no-notes" wx:else>
      <text class="no-notes-text">还没有复盘笔记</text>
      <text class="add-notes-hint">点击"添加"记录你的复盘心得</text>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <button 
      class="action-btn complete"
      bindtap="completeReview"
      wx:if="{{taskDetail.status === 'pending'}}"
    >
      完成复盘
    </button>
    
    <button 
      class="action-btn skip"
      bindtap="skipReview"
      wx:if="{{taskDetail.status === 'pending'}}"
    >
      跳过这次
    </button>
    
    <view class="completed-info" wx:if="{{taskDetail.status === 'completed'}}">
      <text class="completed-text">✓ 本次复盘已完成</text>
      <text class="next-review" wx:if="{{taskDetail.review_count < 5}}">
        下次复盘：{{nextReviewDate}}
      </text>
      <text class="mastered-text" wx:else>
        🎉 已完全掌握！
      </text>
    </view>
  </view>
</view>

<!-- 笔记编辑弹窗 -->
<view class="notes-modal" wx:if="{{showNotesModal}}" bindtap="closeNotesModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">复盘笔记</text>
      <text class="modal-close" bindtap="closeNotesModal">×</text>
    </view>
    
    <view class="modal-body">
      <textarea
        class="notes-textarea"
        placeholder="记录你在复盘过程中的心得体会..."
        value="{{tempNotes}}"
        bindinput="onNotesInput"
        maxlength="500"
        auto-height
      />
      <text class="char-count">{{tempNotes.length}}/500</text>
    </view>
    
    <view class="modal-footer">
      <button class="modal-btn secondary" bindtap="closeNotesModal">
        取消
      </button>
      <button class="modal-btn primary" bindtap="saveNotes">
        保存
      </button>
    </view>
  </view>
</view>