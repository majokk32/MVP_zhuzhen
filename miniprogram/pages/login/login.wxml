<!--pages/login/login.wxml-->
<view class="container">
  <!-- 应用Logo/名称 -->
  <view class="app-header">
    <view class="logo-container">
      <view class="logo-icon">🎓</view>
      <view class="app-name">公考督学助手</view>
    </view>
  </view>

  <!-- 授权说明 -->
  <view class="auth-description">
    <text>为了给您提供完整的学习档案和督学服务，我们需要获取您的公开信息（头像、昵称）。</text>
  </view>

  <!-- 授权按钮区域 -->
  <view class="auth-buttons">
    <!-- 微信授权登录按钮 -->
    <button 
      class="auth-btn primary"
      bindtap="handleQuickLogin"
      disabled="{{loading}}"
    >
      <view class="btn-content">
        <text wx:if="{{!loading}}">微信授权登录</text>
        <text wx:else>登录中...</text>
      </view>
    </button>

    <!-- 手机号授权登录按钮 -->
    <button 
      class="auth-btn secondary"
      open-type="getPhoneNumber"
      bindgetphonenumber="handlePhoneLogin"
      disabled="{{loading}}"
      wx:if="{{showPhoneLogin}}"
    >
      <view class="btn-content">
        <text wx:if="{{!loading}}">📱 手机号快速登录</text>
        <text wx:else>登录中...</text>
      </view>
    </button>
  </view>

  <view class="login-content">

    <!-- 完善资料登录（可选） -->
    <view class="profile-section" wx:if="{{canUseNicknameInput}}">
      <view class="profile-title">完善个人信息</view>
      
      <!-- 头像选择 -->
      <view class="avatar-wrapper">
        <button 
          class="avatar-btn" 
          open-type="chooseAvatar" 
          bindchooseavatar="onChooseAvatar"
        >
          <image class="avatar" src="{{avatarUrl || ''}}" mode="aspectFill" wx:if="{{avatarUrl}}"></image>
          <view class="avatar" wx:else>
            <text class="avatar-icon">👤</text>
          </view>
          <view class="avatar-edit">
            <text>点击修改</text>
          </view>
        </button>
      </view>

      <!-- 昵称输入 -->
      <view class="input-wrapper">
        <input 
          type="nickname" 
          class="nickname-input"
          placeholder="请输入昵称"
          placeholder-class="placeholder"
          value="{{nickname}}"
          bindinput="onNicknameInput"
        />
      </view>

      <!-- 完善资料按钮 -->
      <button 
        class="btn-secondary" 
        bindtap="handleCompleteProfile"
        disabled="{{loading || !nickname}}"
      >
        完善资料并登录
      </button>
    </view>

    <!-- 旧版getUserProfile方式（兼容） -->
    <view class="profile-section" wx:elif="{{canUseGetUserProfile}}">
      <button 
        class="btn-secondary" 
        bindtap="handleCompleteProfile"
        disabled="{{loading}}"
      >
        授权登录
      </button>
    </view>
  </view>

  <!-- 服务条款 -->
  <view class="service-terms">
    <text>登录即代表您已阅读并同意</text>
    <text class="link">《用户服务协议》</text>
    <text>和</text>
    <text class="link">《隐私政策》</text>
  </view>

  <!-- 开发环境跳过按钮 -->
  <view class="dev-controls" wx:if="{{__wxConfig.envVersion === 'develop'}}">
    <button class="skip-btn" bindtap="handleSkip">
      跳过登录(仅开发)
    </button>
  </view>
</view>