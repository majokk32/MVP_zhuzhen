<!--pages/login/login.wxml-->
<view class="container">
  <view class="login-header">
    <!-- <image class="logo" src="/assets/images/logo.png" mode="aspectFit"></image> -->
    <view class="logo-text">🎓</view>
    <view class="title">公考督学助手</view>
    <view class="subtitle">专业的申论作业批改平台</view>
  </view>

  <view class="login-content">
    <!-- 快速登录（推荐） -->
    <view class="quick-login-section">
      <button 
        class="btn-primary" 
        bindtap="handleQuickLogin"
        disabled="{{loading}}"
      >
        <text wx:if="{{!loading}}">微信一键登录</text>
        <text wx:else>登录中...</text>
      </button>
      <view class="tips">推荐使用，快速安全</view>
    </view>

    <!-- 分割线 -->
    <view class="divider-wrapper">
      <view class="divider-line"></view>
      <view class="divider-text">或</view>
      <view class="divider-line"></view>
    </view>

    <!-- 完善资料登录（可选） -->
    <view class="profile-section" wx:if="{{canUseNicknameInput}}">
      <view class="profile-title">完善个人信息</view>
      
      <!-- 头像选择 -->
      <view class="avatar-wrapper">
        <button 
          class="avatar-btn" 
          open-type="chooseAvatar" 
          bindchooseavatar="onChooseAvatar"
        >
          <image class="avatar" src="{{avatarUrl || ''}}" mode="aspectFill" wx:if="{{avatarUrl}}"></image>
          <view class="avatar" wx:else>
            <text class="avatar-icon">👤</text>
          </view>
          <view class="avatar-edit">
            <text>点击修改</text>
          </view>
        </button>
      </view>

      <!-- 昵称输入 -->
      <view class="input-wrapper">
        <input 
          type="nickname" 
          class="nickname-input"
          placeholder="请输入昵称"
          placeholder-class="placeholder"
          value="{{nickname}}"
          bindinput="onNicknameInput"
        />
      </view>

      <!-- 完善资料按钮 -->
      <button 
        class="btn-secondary" 
        bindtap="handleCompleteProfile"
        disabled="{{loading || !nickname}}"
      >
        完善资料并登录
      </button>
    </view>

    <!-- 旧版getUserProfile方式（兼容） -->
    <view class="profile-section" wx:elif="{{canUseGetUserProfile}}">
      <button 
        class="btn-secondary" 
        bindtap="handleCompleteProfile"
        disabled="{{loading}}"
      >
        授权登录
      </button>
    </view>
  </view>

  <!-- 底部说明 -->
  <view class="login-footer">
    <view class="agreement">
      <text>登录即表示同意</text>
      <text class="link">《用户协议》</text>
      <text>和</text>
      <text class="link">《隐私政策》</text>
    </view>
    
    <!-- 开发环境跳过按钮 -->
    <view class="skip-btn" wx:if="{{__wxConfig.envVersion === 'develop'}}" bindtap="handleSkip">
      跳过登录(仅开发)
    </view>
  </view>
</view>