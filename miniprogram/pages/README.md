# 前端页面核心约束文档

## 🎯 页面业务流程约束

### 登录流程约束 (pages/login/)

#### 微信授权流程
1. **首次进入**: 显示授权说明和微信登录按钮
2. **权限请求**: wx.login获取code → 后端验证 → 返回token
3. **用户信息**: wx.getUserProfile获取头像昵称 → 用户确认 → 保存
4. **角色判定**: 后端验证用户角色 → 跳转对应首页

#### 权限验证约束
- **付费学员**: 直接进入任务列表首页
- **试用学员**: 进入任务列表，功能受限提示
- **教师用户**: 进入任务列表，底部显示"教研"标签

### 任务列表页约束 (pages/index/)

#### 任务卡片排序规则
1. **课后加餐任务**: 始终置顶显示（task_type=extra）
2. **其他任务**: 按创建时间倒序（最新在上）
3. **状态过滤**: 支持全部/进行中/已结束筛选

#### 权限显示差异
- **付费学员**: 显示完整任务卡片，可点击进入详情
- **试用学员**: 显示任务信息，点击弹出权限限制提示
- **教师用户**: 显示完整信息，底部多"教研"标签

#### 状态刷新机制
- **下拉刷新**: 重新获取最新任务列表和状态
- **实时更新**: 提交作业后本地更新状态，避免延迟感知

### 任务详情页约束 (pages/task-detail/)

#### 三种视图模式
1. **待提交状态**: 显示题目 + 上传按钮
2. **待批改状态**: 显示题目 + 已上传图片 + 重新提交按钮（次数限制）
3. **已批改状态**: 显示题目 + 作业图片 + 评价档位 + 评语

#### 权限控制逻辑
- **权限验证**: 页面onLoad时验证用户是否有权限访问
- **试用用户**: 显示权限不足页面，引导升级
- **提交验证**: 每次提交前再次验证权限和次数限制

#### 特殊状态处理
- **待复盘状态**: 显示"重新提交"按钮，系统已刷新提交次数
- **课后加餐入口**: 完成首次批改后显示"课后加餐"按钮

### 个人中心页约束 (pages/profile/)

#### V1.0学习数据展示
**核心数据展示区**:
- **连续学习天数**: 超大号数字显示，页面焦点
- **当前积分**: 右上角显示
- **GitHub风格打卡图**: 14天2行×7天布局  
- **数据指标卡片**: 累计提交、本周打卡、历史最佳

#### 功能入口约束
- **我的复盘**: 显示待复盘任务数量角标
- **我的收藏**: 显示收藏资料数量
- **月度排行榜**: 仅付费用户显示，试用用户隐藏
- **设置**: 复盘周期设置等个人配置

#### 权限显示差异
- **付费用户**: 完整数据显示，包含排行榜入口
- **试用用户**: 基础学习数据，无排行榜和高级功能

### 批改相关页面约束 (pages/grading/, pages/admin/)

#### 沉浸式批改界面
**页面布局约束**:
1. **智能导航区**: 进度条、学生信息卡片、快捷操作
2. **作业展示区**: 支持1-6张图片，点击放大查看
3. **混合输入评语区**: 文字+语音+快捷模板
4. **评价选择区**: 三档评价单选，必须选择
5. **操作按钮区**: 上一篇/保存/下一篇，状态逻辑控制

#### 按钮状态逻辑
- **保存按钮**: 默认禁用，选择评价档位后激活
- **下一篇按钮**: 默认禁用，保存成功后激活
- **导航限制**: 防止未保存状态下的误操作

#### 数据统计页面
- **统计面板**: 总览、图表、效率分析、学生洞察
- **历史管理**: 时间线展示、搜索筛选、详情查看
- **导出功能**: 支持PDF/Excel格式报告导出

## 🔧 页面状态管理约束

### 全局状态管理
```javascript
// app.js全局数据
globalData: {
  userInfo: null,        // 用户基本信息
  token: '',             // JWT认证token  
  userRole: 'student',   // 用户角色
  permissions: {},       // 用户权限信息
  learningData: {}       // 学习数据缓存
}
```

### 页面级状态管理
- **data初始化**: 页面data设置合理默认值
- **loading状态**: 数据加载时显示loading，完成后隐藏
- **error处理**: 网络错误、权限错误的统一处理机制
- **缓存策略**: 合理使用本地存储，减少重复请求

### 页面生命周期约束
```javascript
// 标准页面生命周期处理
onLoad(options) {
  // 参数解析、权限验证、初始数据加载
},
onShow() {  
  // 权限状态刷新、数据更新、tabBar状态
},
onHide() {
  // 清理定时器、暂停音频等资源释放
}
```

## 🎨 用户体验约束

### 加载状态设计
- **skeleton骨架屏**: 主要列表页面首次加载
- **loading组件**: 按钮点击、表单提交等操作反馈  
- **进度条**: 文件上传、数据导出等耗时操作
- **占位符**: 图片加载、空数据状态

### 错误处理规范
- **网络错误**: "网络连接失败，请检查网络设置"
- **权限错误**: "当前为试用用户，升级后即可使用完整功能"
- **业务错误**: 具体的错误原因和解决建议
- **兜底方案**: 无法处理的错误提供联系支持方式

### 交互反馈设计
- **点击反馈**: 按钮点击有视觉反馈（颜色变化、阴影等）
- **操作确认**: 重要操作（删除、重置）需要二次确认
- **成功提示**: 操作成功后的toast提示或页面跳转
- **进度指示**: 多步骤操作显示当前进度和剩余步骤

## 📱 微信小程序特定约束

### 官方组件优先使用
**必须使用微信官方组件**:
- **分享功能**: wx.showShareMenu + onShareAppMessage
- **支付功能**: wx.requestPayment官方支付组件
- **地理位置**: wx.getLocation官方定位API
- **相机相册**: wx.chooseImage官方选择器

### 平台限制处理
- **图片大小**: 上传前压缩，避免超过微信限制
- **本地存储**: 合理使用wx.setStorage，定期清理过期缓存
- **页面栈**: 避免页面栈过深，超过10层需要redirectTo
- **网络请求**: 域名白名单配置，HTTPS强制要求

### 审核规范遵循
- **用户隐私**: 明确的隐私政策和数据使用说明
- **内容规范**: 避免敏感词汇，教育内容积极正面
- **功能描述**: 准确描述小程序功能，避免夸大宣传
- **界面规范**: 遵循微信小程序设计指南

## ⚠️ 重要提醒

### 性能优化
1. **首屏加载**: 关键路径优化，首屏渲染时间<2s
2. **图片优化**: webp格式优先，懒加载非关键图片  
3. **代码分包**: 按功能模块分包，减少主包大小
4. **内存管理**: 及时销毁不用的页面实例和定时器

### 数据安全
1. **敏感信息**: Token等敏感信息加密存储
2. **接口调用**: 所有API请求添加认证header
3. **用户数据**: 遵循最小权限原则，仅获取必要信息
4. **错误日志**: 敏感信息不记录到错误日志中

### 兼容性处理  
1. **微信版本**: 兼容近1年主流微信版本
2. **手机型号**: 适配主流Android和iOS设备
3. **屏幕尺寸**: 响应式设计，适配不同屏幕尺寸
4. **降级方案**: 关键功能提供降级备选方案