<!--pages/index/index.wxml-->
<view class="container">
  <!-- È°∂ÈÉ®Ê†áÈ¢òÂíåÊêúÁ¥¢ -->
  <view class="header-section">
    <view class="title-search-container">
      <view class="page-title">Áî≥ËÆ∫ÊâπÊîπ‰ªªÂä°</view>
      <view class="search-btn" bindtap="onSearchToggle">
        <icon class="search-icon" type="search" size="20" color="#6b7280"/>
      </view>
    </view>
    
    <!-- ÊêúÁ¥¢ËæìÂÖ•Ê°ÜÔºàÂ±ïÂºÄÊó∂ÊòæÁ§∫Ôºâ -->
    <view class="search-input-container" wx:if="{{showSearch}}">
      <view class="search-input-box">
        <icon class="search-icon" type="search" size="16" color="#9ca3af"/>
        <input 
          class="search-input" 
          placeholder="ÊêúÁ¥¢‰ªªÂä°ÂÖ≥ÈîÆÂ≠ó"
          placeholder-class="search-placeholder"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearch"
          focus="{{showSearch}}"
        />
        <view wx:if="{{searchKeyword}}" class="clear-btn" bindtap="onClearSearch">
          <icon type="clear" size="14" color="#9ca3af"/>
        </view>
        <view class="cancel-btn" bindtap="onCancelSearch">ÂèñÊ∂à</view>
      </view>
    </view>
  </view>

  <!-- ‰ªªÂä°ÂàóË°® -->
  <view class="task-list-container">
    <!-- È™®Êû∂Â±è -->
    <skeleton show="{{loading}}" type="task-list" count="{{3}}"></skeleton>
    
    <!-- ‰ªªÂä°ÂàóË°® - ‰ΩøÁî®Áõ¥Êé•Ê∏≤ÊüìÔºàÊÄßËÉΩÊõ¥Â•ΩÁöÑËôöÊãüÂàóË°®ÂêéÁª≠‰ºòÂåñÔºâ -->
    <scroll-view
      wx:if="{{!loading}}"
      class="task-scroll-container"
      style="height: {{listHeight}}px;"
      scroll-y
      enable-back-to-top
      refresher-enabled="{{true}}"
      refresher-triggered="{{refreshing}}"
      bindscrolltolower="onLoadMore"
      bindrefresherrefresh="onRefresh"
    >
      <view class="task-list-direct">
        <block wx:for="{{taskList}}" wx:key="id">
          <task-card 
            task="{{item}}"
            index="{{index}}"
            bind:click="onTaskClick"
            bind:toggleStatus="onToggleStatus"
            bind:share="onShareTask"
            bind:viewStats="onViewStats"
          />
        </block>
      </view>
    </scroll-view>
    
    <!-- Á©∫Áä∂ÊÄÅ -->
    <empty-state
      wx:if="{{!loading && isEmpty}}"
      icon="üìù"
      title="ÊöÇÊó†‰ªªÂä°"
      description="{{currentFilter === 'ongoing' ? 'Ê≤°ÊúâËøõË°å‰∏≠ÁöÑ‰ªªÂä°' : currentFilter === 'ended' ? 'Ê≤°ÊúâÂ∑≤ÁªìÊùüÁöÑ‰ªªÂä°' : 'ËÄÅÂ∏àËøòÊ≤°ÊúâÂèëÂ∏É‰ªªÂä°'}}"
      show-action="{{isTeacher}}"
      action-text="Á´ãÂç≥ÂàõÂª∫‰ªªÂä°"
      action-type="primary"
      bind:actionClick="onCreateTask"
    />

    <!-- Âä†ËΩΩÊõ¥Â§ö -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <text class="loading-text">Âä†ËΩΩ‰∏≠...</text>
    </view>

    <!-- Ê≤°ÊúâÊõ¥Â§ö -->
    <view wx:if="{{!hasMore && taskList.length > 0}}" class="no-more">
      <text class="no-more-text">- Ê≤°ÊúâÊõ¥Â§ö‰∫Ü -</text>
    </view>

    <!-- Âä†ËΩΩ‰∏≠ -->
    <view wx:if="{{loading && taskList.length === 0}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">Âä†ËΩΩ‰∏≠...</text>
    </view>
  </view>

  <!-- Â∫ïÈÉ®ÂÆâÂÖ®Âå∫ -->
  <view class="safe-bottom"></view>
</view>

<!-- ÂçáÁ∫ßÂºïÂØºÁªÑ‰ª∂ -->
<upgrade-guide 
  show="{{showUpgradeGuide}}"
  guideType="{{upgradeGuideType}}"
  featureName="‰ªªÂä°ËØ¶ÊÉÖÊü•Áúã"
  bind:close="onUpgradeGuideClose"
/>