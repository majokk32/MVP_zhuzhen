# æ•°æ®æ¨¡å‹æ ¸å¿ƒçº¦æŸæ–‡æ¡£

## ğŸ¯ æ ¸å¿ƒæ•°æ®æ¨¡å‹è¯­ä¹‰

### User æ¨¡å‹çº¦æŸ
```python
class User(Base):
    # åŸºç¡€èº«ä»½ä¿¡æ¯
    openid: str      # å¾®ä¿¡å”¯ä¸€æ ‡è¯†ï¼Œå¿…é¡»å”¯ä¸€ç´¢å¼•
    unionid: str     # å¾®ä¿¡ç»Ÿä¸€æ ‡è¯†ï¼Œå¯é€‰ä½†å»ºè®®è®¾ç½®
    nickname: str    # ç”¨æˆ·æ˜µç§°ï¼Œå¯åœ¨å°ç¨‹åºå†…ä¿®æ”¹
    role: UserRole   # è§’è‰²ï¼šstudent(å­¦ç”Ÿ)/teacher(æ•™å¸ˆ)
    
    # V1.0 å­¦ä¹ æ•°æ®ç»Ÿè®¡å­—æ®µ
    current_streak: int    # å½“å‰è¿ç»­å­¦ä¹ å¤©æ•°ï¼Œä¸­æ–­æ¸…é›¶
    best_streak: int       # å†å²æœ€ä½³è¿ç»­å¤©æ•°ï¼Œåªå¢ä¸å‡
    total_score: int       # ç´¯è®¡æ€»ç§¯åˆ†ï¼Œæ°¸ä¸æ¸…é›¶
    monthly_score: int     # æœˆåº¦ç§¯åˆ†ï¼Œæ¯æœˆ1æ—¥é‡ç½®
    quarterly_score: int   # å­£åº¦ç§¯åˆ†ï¼Œå›½è€ƒå­£(10-12æœˆ)ä½¿ç”¨
    last_checkin_date: Date # æœ€åæ‰“å¡æ—¥æœŸï¼Œç”¨äºè¿ç»­å¤©æ•°è®¡ç®—
    total_submissions: int  # ç´¯è®¡æäº¤æ¬¡æ•°ï¼Œä»˜è´¹ç”¨æˆ·ç»Ÿè®¡
    
    # è®¢é˜…æƒé™æ§åˆ¶
    subscription_type: SubscriptionType  # TRIAL(è¯•ç”¨)/PREMIUM(ä»˜è´¹)/EXPIRED(è¿‡æœŸ)
    subscription_expires_at: DateTime   # è®¢é˜…åˆ°æœŸæ—¶é—´
    trial_started_at: DateTime          # è¯•ç”¨å¼€å§‹æ—¶é—´
```

### Task æ¨¡å‹çº¦æŸ
```python
class Task(Base):
    title: str           # ä»»åŠ¡æ ‡é¢˜ï¼Œæ˜¾ç¤ºåœ¨å¡ç‰‡å·¦ä¸Šè§’
    course: str          # è¯¾ç¨‹ä¿¡æ¯ï¼Œä»»åŠ¡å½’å±è¯¾ç¨‹
    desc: Text           # é¢˜ç›®è¯¦æƒ…ï¼Œå®Œæ•´çš„ä»»åŠ¡è¦æ±‚æè¿°
    deadline: DateTime   # æˆªæ­¢æ—¶é—´ï¼Œç”¨äºè¯¾å‰æé†’
    status: TaskStatus   # ä»»åŠ¡çŠ¶æ€ï¼šongoing(è¿›è¡Œä¸­)/ended(å·²ç»“æŸ)
    task_type: TaskType  # ä»»åŠ¡ç±»å‹ï¼šlive(ç›´æ’­è¯¾)/extra(è¯¾ååŠ é¤)/normal(æ™®é€š)
    
    # é‡è¦ï¼šè¯¾ååŠ é¤ä»»åŠ¡(task_type=extra)åœ¨å­¦ç”Ÿç«¯è‡ªåŠ¨ç½®é¡¶æ˜¾ç¤º
    created_by: int      # åˆ›å»ºè€…IDï¼Œå…³è”Userè¡¨
    created_at: DateTime # åˆ›å»ºæ—¶é—´ï¼Œç”¨äºæ’åº
```

### Submission æ¨¡å‹çº¦æŸ  
```python
class Submission(Base):
    task_id: int             # å…³è”ä»»åŠ¡ID
    student_id: int          # æäº¤å­¦ç”ŸIDï¼Œå¿…é¡»æ˜¯ä»˜è´¹ç”¨æˆ·
    images: JSON             # ä½œä¸šå›¾ç‰‡URLsåˆ—è¡¨ï¼Œæœ€å¤š6å¼ 
    submission_count: int    # æäº¤æ¬¡æ•°ï¼Œæœ€å¤§å€¼3ï¼Œå¾…å¤ç›˜æ—¶é‡ç½®
    
    # æ‰¹æ”¹ç›¸å…³
    score: Float             # å¾—åˆ†ï¼Œå¯é€‰
    grade: Grade             # è¯„ä»·ï¼šå¾…å¤ç›˜/ä¼˜ç§€/æä½³
    feedback: Text           # è¯„è¯­ï¼Œæ”¯æŒé•¿æ–‡æœ¬
    graded_by: int           # æ‰¹æ”¹æ•™å¸ˆID
    graded_at: DateTime      # æ‰¹æ”¹æ—¶é—´
    
    status: SubmissionStatus # çŠ¶æ€ï¼šsubmitted(å·²æäº¤)/graded(å·²æ‰¹æ”¹)
```

### æƒé™æ§åˆ¶æšä¸¾
```python
class SubscriptionType(str, enum.Enum):
    TRIAL = "trial"      # è¯•ç”¨ç”¨æˆ·ï¼š7å¤©è¯•ç”¨æœŸï¼Œåªèƒ½æµè§ˆæ— æ³•æäº¤
    PREMIUM = "premium"  # ä»˜è´¹ç”¨æˆ·ï¼šå®Œæ•´åŠŸèƒ½ä½¿ç”¨æƒé™
    EXPIRED = "expired"  # è¿‡æœŸç”¨æˆ·ï¼šç±»ä¼¼è¯•ç”¨ç”¨æˆ·ï¼Œä½†æ›¾ç»æ˜¯ä»˜è´¹ç”¨æˆ·

class Grade(str, enum.Enum):
    PENDING = "å¾…å¤ç›˜"   # éœ€è¦é‡æ–°å­¦ä¹ ï¼Œè‡ªåŠ¨åˆ·æ–°æäº¤æ¬¡æ•°
    GOOD = "ä¼˜ç§€"        # è´¨é‡è‰¯å¥½
    EXCELLENT = "æä½³"   # æ¥è¿‘æ»¡åˆ†æ°´å¹³
```

## ğŸ”§ æ•°æ®å…³ç³»çº¦æŸ

### æ ¸å¿ƒä¸šåŠ¡å…³ç³»
1. **User â†” Task**: ä¸€å¯¹å¤šå…³ç³»ï¼Œæ•™å¸ˆå¯åˆ›å»ºå¤šä¸ªä»»åŠ¡
2. **User â†” Submission**: ä¸€å¯¹å¤šå…³ç³»ï¼Œå­¦ç”Ÿå¯æäº¤å¤šä»½ä½œä¸š
3. **Task â†” Submission**: ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªä»»åŠ¡å¯¹åº”å¤šä¸ªå­¦ç”Ÿæäº¤

### V1.0 å­¦ä¹ æ•°æ®å…³ç³»
1. **User â†” UserCheckin**: ä¸€å¯¹å¤šå…³ç³»ï¼Œè®°å½•æ¯æ—¥æ‰“å¡
2. **User â†” UserScoreRecord**: ä¸€å¯¹å¤šå…³ç³»ï¼Œè®°å½•ç§¯åˆ†å˜åŒ–å†å²
3. **User â†” ReviewSettings**: ä¸€å¯¹ä¸€å…³ç³»ï¼Œä¸ªäººå¤ç›˜è®¾ç½®

### æŠ€æœ¯é¢„ç•™å…³ç³» (V2.0)
1. **User â†” UserAchievements**: æˆå°±å¾½ç« ç³»ç»Ÿï¼Œå·²é¢„ç•™å­—æ®µ
2. **Task â†” TaskMaterials**: è¯¾ååŠ é¤èµ„æ–™ç³»ç»Ÿ

## ğŸ“Š ç´¢å¼•å’Œæ€§èƒ½çº¦æŸ

### å¿…éœ€ç´¢å¼•
```sql
-- ç”¨æˆ·å¿«é€ŸæŸ¥è¯¢
CREATE INDEX idx_users_openid ON users(openid);
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_users_subscription ON users(subscription_type);

-- ä»»åŠ¡æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_tasks_status_type ON tasks(status, task_type);
CREATE INDEX idx_tasks_created_by ON tasks(created_by);

-- æäº¤è®°å½•ä¼˜åŒ–
CREATE INDEX idx_submissions_student_task ON submissions(student_id, task_id);
CREATE INDEX idx_submissions_status ON submissions(status);
```

### æ•°æ®å®Œæ•´æ€§çº¦æŸ
1. **å¤–é”®çº¦æŸ**: ç¡®ä¿æ•°æ®å¼•ç”¨å®Œæ•´æ€§
2. **å”¯ä¸€çº¦æŸ**: openidå…¨å±€å”¯ä¸€
3. **éç©ºçº¦æŸ**: æ ¸å¿ƒå­—æ®µä¸èƒ½ä¸ºç©º
4. **æšä¸¾çº¦æŸ**: çŠ¶æ€å­—æ®µåªèƒ½ä½¿ç”¨é¢„å®šä¹‰å€¼

## âš ï¸ é‡è¦æé†’

### æ•°æ®ç»Ÿè®¡åŸåˆ™
1. **ä»˜è´¹ç”¨æˆ·ç»Ÿè®¡**: åªæœ‰premiumç”¨æˆ·çš„æ•°æ®è®¡å…¥æ•™å­¦ç»Ÿè®¡
2. **è¯•ç”¨ç”¨æˆ·éš”ç¦»**: trialç”¨æˆ·æ•°æ®ç‹¬ç«‹å­˜å‚¨ï¼Œä¸å½±å“ä¸šåŠ¡ç»Ÿè®¡  
3. **æ•°æ®ä¸€è‡´æ€§**: å­¦ä¹ æ•°æ®å­—æ®µå¿…é¡»ä¸ç»Ÿè®¡ç®—æ³•ä¿æŒä¸€è‡´

### æ€§èƒ½è€ƒè™‘
1. **æ‰¹é‡æ›´æ–°**: è¿ç»­å¤©æ•°ç­‰ç»Ÿè®¡æ•°æ®æ‰¹é‡è®¡ç®—æ›´æ–°
2. **ç¼“å­˜ç­–ç•¥**: é¢‘ç¹æŸ¥è¯¢çš„ç»Ÿè®¡æ•°æ®ä½¿ç”¨ç¼“å­˜
3. **åˆ†é¡µæŸ¥è¯¢**: å¤§æ•°æ®é‡æŸ¥è¯¢å¿…é¡»åˆ†é¡µå¤„ç†

### ç‰ˆæœ¬å…¼å®¹
1. **å‘å‰å…¼å®¹**: æ–°å¢å­—æ®µè®¾ç½®é»˜è®¤å€¼ï¼Œä¸å½±å“ç°æœ‰æ•°æ®
2. **è¿ç§»è„šæœ¬**: æ•°æ®ç»“æ„å˜æ›´æä¾›å®Œæ•´è¿ç§»æ–¹æ¡ˆ
3. **æŠ€æœ¯é¢„ç•™**: V2.0åŠŸèƒ½å­—æ®µå·²é¢„ç•™ï¼Œé¿å…é¢‘ç¹è¿ç§»