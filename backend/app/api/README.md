# API模块核心约束文档

## 🎯 业务逻辑核心约束

### 用户权限控制
- **付费学员**: 可提交作业、查看批改结果、使用完整功能
- **试用学员**: 仅可浏览任务卡片，点击显示无权限提示
- **教师用户**: 拥有所有学生权限 + 教研管理权限

### 任务状态管理
**四要素显示**:
1. **左上角标题**: 课程/题目名称
2. **右上角评价**: 待提交/待批改/待复盘/优秀/极佳
3. **左下角状态**: 正在进行中/课后加餐/已结束/已完成
4. **右下角日期**: 直播/课程开始日期

**置顶规则**: 课后加餐任务始终置顶显示，直到完成

### 作业提交约束
- **提交限制**: 每任务最多3次提交，新提交覆盖旧提交
- **权限验证**: 提交前必须验证付费学员身份
- **待复盘重提交**: 评价为"待复盘"时自动刷新上传次数

### 批改流程约束
**评价三档**:
- `待复盘`: 需要学生重新学习和提交
- `优秀`: 质量良好，可以继续深化
- `极佳`: 接近满分水平

**导航逻辑**:
- 选择评价档位 → 保存按钮激活
- 保存成功 → 下一篇按钮激活
- 支持上一篇/下一篇快速切换

### 统计数据规则
**仅统计付费学员**:
- 提交统计、批改进度仅计算付费学员
- 试用用户不纳入任何教学统计
- 教师能查看但区分两类用户

## 🔧 API响应格式
```json
{
  "code": 0,        // 0=成功，其他=错误码
  "msg": "ok",      // 人类可读消息
  "data": {}        // 实际数据
}
```

## 📋 关键API约束
- `/api/v1/users/*` - 用户认证和权限管理
- `/api/v1/tasks/*` - 任务创建、查询、状态管理
- `/api/v1/submissions/*` - 作业提交、批改、查询
- `/api/v1/admin/*` - 教研管理专用接口

## ⚠️ 重要提醒
1. **权限验证**: 所有API调用前必须验证用户权限
2. **状态一致性**: 前后端状态计算逻辑统一
3. **错误处理**: 使用统一异常处理机制
4. **数据安全**: 敏感信息加密传输和存储